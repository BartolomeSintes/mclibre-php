<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Sesiones (1). Soluciones. Sin formularios. Ejercicios. PHP. Bartolomé Sintes Marco. www.mclibre.org</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="../../varios/php.css" title="mclibre" />
  <link rel="icon" href="../../varios/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="../../varios/highlight-php.css" />
  <script src="../../varios/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
  <h1>Soluciones - Sesiones (1)</h1>

  <nav>
    <p>
      <a href="../../index.html"><img src="../../varios/iconos/icono-php.svg" alt="Índice de PHP" title="Índice de PHP" width="48" height="48" /></a>
      <a href="#"><img src="../../varios/iconos/icono-arrow-circle-up.svg" alt="Principio de la página" title="Principio de la página" width="36" height="36" /></a>
    </p>

    <div class="toc">
      <h2>Sesiones (1)</h2>

      <ul>
        <li>Iniciales
          <ul>
            <li><a href="#ejercicio-01">01 - Formulario Nombre (1)</a></li>
            <li><a href="#ejercicio-02">02 - Formulario Nombre (2)</a></li>
            <li><a href="#ejercicio-03">03 - Subir y bajar número</a></li>
            <li><a href="#ejercicio-04">04 - Mover un punto</a></li>
            <li><a href="#ejercicio-05">05 - Mover un punto 2D</a></li>
            <li><a href="#ejercicio-06">06 - Votar una opción</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  <p>En esta página se muestran una parte de las soluciones de los ejercicios <a href="../../ejercicios/sesiones/sesiones-1/index.html">Sesiones (1)</a>. La solución completa se puede descargar de la <a href="../index.html">página de soluciones</a>.</p>

  <p><img src="../../varios/iconos/icono-warning.svg" alt="¡Atención!" title="¡Atención!" width="55" height="48" />Únicamente he actualizado en esta páginas la solución de los cinco primeros ejercicios. En el archivo para descargar se encuentra las soluciones completas.</p>

  <p><img src="../../varios/iconos/icono-warning.svg" alt="¡Atención!" title="¡Atención!" width="55" height="48" />Para hacer estos ejercicios, se recomienda seguir el recorrido de la aplicación, suponiendo que el usuario introduce datos. Pero después hay que comprobar desde el principio (cerrando el navegador previamente) que la aplicación funciona correctamente (es decir, que la aplicación tiene en cuenta que la primera vez que se ejecuta, todavía no hay datos).</p>

  <section id="iniciales">
    <h2>Ejercicios iniciales</h2>

    <section id="ejercicio-01">
      <h3>Sesiones (1) 01 - Formulario Nombre (1)</h3>

      <p>Este podría ser el orden en que se iría realizando este ejercicio:</p>

      <ol>
        <li>Primero, la página 2 debe recoger el dato enviado por el formulario de la página 1. Es el procedimiento habitual: función recoge(), variable para recoger el dato, variable auxiliar que indica la corrección del dato, comprobación y mensajes de error, si el dato es correcto, mensaje final.</li>
        <li>Pero si el dato es correcto, debemos guardarlo en una variable de sesión, para que la página 1 pueda acceder a él.</li>
        <li>Para que la página 2 pueda guardar datos en $_SESSION, debemos unir la página a la sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
        <li>La página 1 muestra el nombre guardado en $_SESSION.</li>
        <li>Para que la página 1 pueda usar datos de $_SESSION, debemos unir la página a la sesión. El nombre de la sesión debe ser el mismo en ambas páginas.</li>
        <li>Pero la primera vez que se abre la página, $_SESSION no contiene ningún dato e intentar imprimirlo provocaría un error, por lo que añadimos la condición de que la variable que vamos a imprimir exista.</li>
      </ol>

      <p>sesiones-1-01-1.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2784;</span>
// Se accede a la sesión
session_name("sesiones-1-01");
session_start();
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
&lt;!DOCTYPE html&gt;
...
&lt;body&gt;
  &lt;h1&gt;Formulario Nombre 1 (Formulario)&lt;/h1&gt;
</code>
</pre>
        <pre>
<code class="language-php">&lt;?php
// Si hay un nombre guardado en la sesión, se muestra
if (isset($_SESSION["nombre"])) {<span class="numero-circulo">&#x2785;</span>
    print "  &lt;p&gt;Su nombre es: &lt;strong&gt;$_SESSION[nombre]&lt;/strong&gt;.&lt;/p&gt;\n";<span class="numero-circulo">&#x2783;</span>
    print "\n";
}
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
  &lt;form action="sesiones-1-01-2.php" method="get"&gt;
    &lt;p&gt;Escriba su nombre:&lt;/p&gt;
...
</code>
</pre>
      </div>

      <p>sesiones-1-01-2.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2782;</span>
// Se accede a la sesión
session_name("sesiones-1-01");
session_start();
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
&lt;!DOCTYPE html&gt;
...
&lt;body&gt;
  &lt;h1&gt;Formulario Nombre 1 (Resultado)&lt;/h1&gt;
</code>
</pre>
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2780;</span>
// Funciones auxiliares
function recoge($var)
{
    $tmp = (isset($_REQUEST[$var]))
    ? trim(htmlspecialchars($_REQUEST[$var], ENT_QUOTES, "UTF-8"))
    : "";
    return $tmp;
}

// Recogida de nombre
$nombre   = recoge("nombre");
$nombreOk = false;

// Comprobación de nombre
if ($nombre == "") {
    print "  &lt;p class=\"aviso\"&gt;No ha escrito su nombre.&lt;/p&gt;\n";
} else {
    $nombreOk = true;
}

// Si el nombre es válido ...
if ($nombreOk) {
  // se guarda el nombre en la sesión
    $_SESSION["nombre"] = $nombre;<span class="numero-circulo">&#x2781;</span>
    // y se muestra
    print "  &lt;p&gt;Su nombre es: &lt;strong&gt;$nombre&lt;/strong&gt;.&lt;/p&gt;\n";
}
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
    &lt;p&gt;&lt;a href="sesiones-1-01-1.php"&gt;Volver a la primera página.&lt;/a&gt;&lt;/p&gt;
...
</code>
</pre>
      </div>
    </section>

    <section id="ejercicio-02">
      <h3>Sesiones (1) 02 - Formulario Nombre (2)</h3>

      <p>Este ejercicio es muy parecido al anterior. Este podría ser el orden en que se iría realizando este ejercicio:</p>

      <ol start="0">
        <li>Puesto que la página 2 redirige a la página 1, la página 2 no debe tener nada de HTML, ni ningún <span class="php-res">print</span>.</li>
        <li>Primero, la página 2 debe recoger el dato enviado por el formulario de la página 1. Al principio es el procedimiento habitual: función recoge(), variable para recoger el dato, variable auxiliar que indica la corrección del dato, ...</li>
        <li>... pero en la comprobación si no se recibe nada, vuelve al formulario.</li>
        <li> ... y si el dato es correcto, tampoco se imprime ningún mensaje, pero el dato se guarda en una variable de sesión, para que la página 1 pueda acceder a él.</li>
        <li>Para que la página 2 pueda guardar datos en $_SESSION, debemos unir la página a la sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
        <li>Finalmente, la página 2 redirige a la página 1.</li>
        <li>La página 1 muestra el nombre guardado en $_SESSION.</li>
        <li>Para que la página 1 pueda usar datos de $_SESSION, debemos unir la página a la sesión. El nombre de la sesión debe ser el mismo en ambas páginas.</li>
        <li>Pero la primera vez que se abre la página, $_SESSION no contiene ningún dato e intentar imprimirlo provocaría un error, por lo que añadimos la condición de que la variable que vamos a imprimir exista.</li>
      </ol>

      <p>sesiones-1-02-1.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-02");<span class="numero-circulo">&#x2786;</span>
session_start();
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
&lt;!DOCTYPE html&gt;
...
&lt;body&gt;
  &lt;h1&gt;Formulario Nombre 2 (Formulario)&lt;/h1&gt;
</code>
</pre>
        <pre>
<code class="language-php">&lt;?php
// Si hay un nombre guardado en la sesión, se muestra
if (isset($_SESSION["nombre"])) {<span class="numero-circulo">&#x2787;</span>
    print "  &lt;p&gt;Su nombre es: &lt;strong&gt;$_SESSION[nombre]&lt;/strong&gt;.&lt;/p&gt;\n";<span class="numero-circulo">&#x2785;</span>
    print "\n";
}
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
  &lt;form action="sesiones-1-02-2.php" method="get"&gt;
    &lt;p&gt;Escriba su nombre:&lt;/p&gt;
...</code>
</pre>
      </div>

      <p>sesiones-1-02-2.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-02");<span class="numero-circulo">&#x2783;</span>
session_start();

// Funciones auxiliares
function recoge($var)<span class="numero-circulo">&#x2780;</span>
{
    $tmp = (isset($_REQUEST[$var]))
    ? trim(htmlspecialchars($_REQUEST[$var], ENT_QUOTES, "UTF-8"))
    : "";
    return $tmp;
}

// Recogida de nombre
$nombre   = recoge("nombre");
$nombreOk = false;

// Comprobación de nombre
if ($nombre == "") {
    // Si no se recibe nombre, se vuelve al formulario
    header("Location:sesiones-1-02-1.php");<span class="numero-circulo">&#x2781;</span>
    exit;
} else {
    $nombreOk = true;
}

// Si el nombre es válido ...
if ($nombreOk) {
  // guarda el nombre en la sesión
    $_SESSION["nombre"] = $nombre;<span class="numero-circulo">&#x2782;</span>
    // y vuelve al formulario
    header("Location:sesiones-1-02-1.php");<span class="numero-circulo">&#x2784;</span>
    exit;
}
?&gt;</code>
</pre>
      </div>
    </section>

    <section id="ejercicio-03">
      <h2>Sesiones (1) 03 - Subir y bajar número</h2>

      <ol start="0">
        <li>Puesto que la página 2 redirige a la página 1, la página 2 no debe tener nada de HTML, ni ningún <span class="php-res">print</span>.</li>
        <li>Primero, la página 2 debe recoger el dato enviado por el formulario de la página 1. En la página 1 hay 3 botones, pero los tres tienen el mismo <span class="html-atri">name</span>, por lo que sólo hay que recoger un dato.
          <p>Como en el ejercicio anterior: función recoge(), variable para recoger el dato, variable auxiliar que indica la corrección del dato, comprobación y reenvío al formualrio si no es uno de los valores válidos ...</p>
        </li>
        <li>El valor que muestra la página 1 se modifica en la página 2, dependiendo del dato recibido (se aumenta, se reduce o se pone a cero).</li>
        <li>Para que la página 2 pueda guardar datos en $_SESSION, debemos unir la página a la sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
        <li>La variable de sesión se debe inicializar antes de modificarla (la manera más simple de hacerlo es darle valor si no existe).</li>
        <li>Finalmente, la página 2 redirige a la página 1.</li>
        <li>La página 1 muestra el número guardado en $_SESSION.</li>
        <li>Para que la página 1 pueda usar datos de $_SESSION, debemos unir la página a la sesión. El nombre de la sesión debe ser el mismo en ambas páginas.</li>
        <li>Pero la primera vez que se abre la página, $_SESSION no contiene ningún dato e intentar imprimirlo provocaría un error, por lo que damos valor a la variable si no existe.</li>
      </ol>

      <p>sesiones-1-03-1.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-03");<span class="numero-circulo">&#x2786;</span>
session_start();

// Si el número no está guardado en la sesión, lo pone a cero
if (!isset($_SESSION["numero"])) {<span class="numero-circulo">&#x2787;</span>
    $_SESSION["numero"] = 0;
}
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
&lt;!DOCTYPE html&gt;
...
    &lt;p&gt;
      &lt;button type="submit" name="accion" value="bajar" style="font-size: 4rem"&gt;-&lt;/button&gt;
</code>
</pre>
        <pre>
<code class="language-php">&lt;?php
// Muestra el número, guardado en la sesión
print "      &lt;span style=\"font-size: 4rem\"&gt;$_SESSION[numero]&lt;/span&gt;\n";<span class="numero-circulo">&#x2785;</span>
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
      &lt;button type="submit" name="accion" value="subir" style="font-size: 4rem"&gt;+&lt;/button&gt;
    &lt;/p&gt;
...</code>
</pre>
      </div>

      <p>sesiones-1-03-2.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-03");<span class="numero-circulo">&#x2782;</span>
session_start();

// Si el número no está guardado en la sesión, vuelve al formulario
if (!isset($_SESSION["numero"])) {<span class="numero-circulo">&#x2783;</span>
    $_SESSION["numero"] = 0;
}

// Funciones auxiliares
function recoge($var)<span class="numero-circulo">&#x2780;</span>
{
    $tmp = (isset($_REQUEST[$var]))
    ? trim(htmlspecialchars($_REQUEST[$var], ENT_QUOTES, "UTF-8"))
    : "";
    return $tmp;
}

// Recogida de accion
$accion = recoge("accion");
$accionOk = false;

// Comprobación de accion
if ($accion != "Poner a cero" && $accion != "subir" && $accion != "bajar") {
    // Si no es una de las tres posibles acciones, se vuelve al formulario
    header("Location:sesiones-1-03-1.php");
    exit;
} else {
    $accionOk = true;
}

// Si la accion recibibida es válida ...
if ($accionOk) {
    // Cambia el valor del número
    if ($accion == "Poner a cero") {<span class="numero-circulo">&#x2781;</span>
        $_SESSION["numero"] = 0;
    } elseif ($accion == "subir") {
        $_SESSION["numero"] ++;
    } elseif ($accion == "bajar") {
        $_SESSION["numero"] --;
    }

    // y vuelve al formulario
    header("Location:sesiones-1-03-1.php");<span class="numero-circulo">&#x2784;</span>
    exit;
}
?&gt;</code>
</pre>
      </div>
    </section>

    <section id="ejercicio-04">
      <h2>Sesiones (1) 04 - Mover un punto a derecha e izquierda</h2>

      <p>Este ejercicio es muy similar al anterior: mediante dos botones se aumenta o disminuye un valor. la diferencia es que en este ejercicio el valor no se muestra, pero se utiliza para situar un punto en una línea.</p>

      <ol start="0">
        <li>Puesto que la página 2 redirige a la página 1, la página 2 no debe tener nada de HTML, ni ningún <span class="php-res">print</span>.</li>
        <li>Primero, la página 2 debe recoger el dato enviado por el formulario de la página 1. En la página 1 hay 3 botones, pero los tres tienen el mismo <span class="html-atri">name</span>, por lo que sólo hay que recoger un dato.
          <p>Como en el ejercicio anterior: función recoge(), variable para recoger el dato, variable auxiliar que indica la corrección del dato, comprobación y reenvío al formualrio si no es uno de los valores válidos ...</p>
        </li>
        <li>El valor que se utiliza en la página 1 se modifica en la página 2, dependiendo del dato recibido (se aumenta, se reduce o se pone a cero).</li>
        <li>Para que la página 2 pueda guardar datos en $_SESSION, debemos unir la página a la sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
        <li>La variable de sesión se debe inicializar antes de modificarla (la manera más simple de hacerlo es darle valor si no existe).</li>
        <li>Finalmente, la página 2 redirige a la página 1.</li>
        <li>La página 1 dibuja el punto rojo en la imagen SVG utilizando el número guardado en $_SESSION.</li>
        <li>Para que la página 1 pueda usar datos de $_SESSION, debemos unir la página a la sesión. El nombre de la sesión debe ser el mismo en ambas páginas.</li>
        <li>Pero la primera vez que se abre la página, $_SESSION no contiene ningún dato e intentar imprimirlo provocaría un error, por lo que damos valor a la variable si no existe.</li>
        <li>Para que cuando el punto salga por un lado del dibujo entre por el otro, se debe comprobar si el valor supera los extremos y, en su caso, cambiarlo por el otro valor extremo.</li>
      </ol>

      <p>sesiones-1-04-1.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-04");<span class="numero-circulo">&#x2786;</span>
session_start();

// Si la posición no está guardada en la sesión, la pone a cero
if (!isset($_SESSION["posicion"])) {<span class="numero-circulo">&#x2787;</span>
    $_SESSION["posicion"] = 0;
}
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
&lt;!DOCTYPE html&gt;
...
            &lt;line x1=\"-300\" y1=\"10\" x2=\"300\" y2=\"10\" stroke=\"black\" stroke-width=\"5\" /&gt;</code>
</pre>
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2785;</span>
// Dibuja el círculo en su posición
print "            &lt;circle cx=\"$_SESSION[posicion]\" cy=\"10\" r=\"8\" fill=\"red\" /&gt;\n";
?&gt;</code>
<code class="language-html">          &lt;/svg&gt;
...</code>
</pre>
      </div>

      <p>sesiones-1-04-2.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-04");<span class="numero-circulo">&#x2782;</span>
session_start();

// Si la posición no está guardada en la sesión, la pone a cero
if (!isset($_SESSION["posicion"])) {<span class="numero-circulo">&#x2783;</span>
    $_SESSION["posicion"] = 0;
}

// Funciones auxiliares
function recoge($var)<span class="numero-circulo">&#x2780;</span>
{
    $tmp = (isset($_REQUEST[$var]))
    ? trim(htmlspecialchars($_REQUEST[$var], ENT_QUOTES, "UTF-8"))
    : "";
    return $tmp;
}

// Recogida de accion
$accion = recoge("accion");
$accionOk = true;

// Comprobación de accion
if ($accion != "Volver al centro" && $accion != "izquierda" && $accion != "derecha") {
    // Si no es una de las tres posibles acciones, se vuelve al formulario
    header("Location:sesiones-1-04-1.php");
    exit;
} else {
    $accionOk = true;
}

// Si la accion recibibida es válida ...
if ($accionOk) {
    //se mueve el punto
    if ($accion == "Volver al centro") {<span class="numero-circulo">&#x2781;</span>
        $_SESSION["posicion"] = 0;
    } elseif ($accion == "izquierda") {
        $_SESSION["posicion"] -= 20;
    } elseif ($accion == "derecha") {
        $_SESSION["posicion"] += 20;
    }

    // si sale por un lado, entra por el otro
    if ($_SESSION["posicion"] &gt; 300) {<span class="numero-circulo">&#x2788;</span>
        $_SESSION["posicion"] = -300;
    } elseif ($_SESSION["posicion"] &lt; -300) {
        $_SESSION["posicion"] = 300;
    }

    // y vuelve al formulario
    header("Location:sesiones-1-04-1.php");<span class="numero-circulo">&#x2784;</span>
    exit;
}
?&gt;</code>
</pre>
      </div>
    </section>

    <section id="ejercicio-05">
      <h2>Sesiones (1) 05 - Mover un punto en dos dimensiones</h2>

      <p>Este ejercicio es muy similar al anterior. La diferencia es que en este ejercicio se tendrán que guardar dos valores (coordenada X y coordenada Y) para situar el punto en el plano.</p>

      <ol start="0">
        <li>Puesto que la página 2 redirige a la página 1, la página 2 no debe tener nada de HTML, ni ningún <span class="php-res">print</span>.</li>
        <li>Primero, la página 2 debe recoger el dato enviado por el formulario de la página 1. En la página 1 hay 5 botones, pero los cinco tienen el mismo <span class="html-atri">name</span>, por lo que sólo hay que recoger un dato.
          <p>Como en el ejercicio anterior: función recoge(), variable para recoger el dato, variable auxiliar que indica la corrección del dato, comprobación y reenvío al formualrio si no es uno de los valores válidos ...</p>
        </li>
        <li>Los dos valores que se utilizan en la página 1 se modifican en la página 2, dependiendo del dato recibido (se aumenta o se reduce uno de ellos o se ponen los dos a cero).</li>
        <li>Para que la página 2 pueda guardar datos en $_SESSION, debemos unir la página a la sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
        <li>Las variables de sesión se deben inicializar antes de modificarlas (la manera más simple de hacerlo es darles valor si no existen).</li>
        <li>Finalmente, la página 2 redirige a la página 1.</li>
        <li>La página 1 constuye una imagen SVG utilizando los dos números guardados en $_SESSION.</li>
        <li>Para que la página 1 pueda usar datos de $_SESSION, debemos unir la página a la sesión. El nombre de la sesión debe ser el mismo en ambas páginas.</li>
        <li>Pero la primera vez que se abre la página, $_SESSION no contiene ningún dato e intentar imprimirlo provocaría un error, por lo que damos valor a las variables si no existen.</li>
        <li>Para que cuando el punto salga por un lado del dibujo entre por el otro, se debe comprobar si el valor supera los extremos y, en su caso, cambiarlo por el otro valor extremo.</li>
      </ol>

      <p>sesiones-1-05-1.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-05");<span class="numero-circulo">&#x2786;</span>
session_start();

// Si alguna posición no está guardada en la sesión, las pone a cero
if (!isset($_SESSION["x"]) || !isset($_SESSION["y"])) {<span class="numero-circulo">&#x2787;</span>
    $_SESSION["x"] = $_SESSION["y"] = 0;
}
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
&lt;!DOCTYPE html&gt;
...
        &lt;td&gt;
          &lt;svg version="1.1" xmlns="http://www.w3.org/2000/svg"
          width="400" height="400" viewbox="-200 -200 400 400" style="border: black 2px solid"&gt;
</code>
</pre>
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2785;</span>
// Dibuja el círculo en su posición
print "            &lt;circle cx=\"$_SESSION[x]\" cy=\"$_SESSION[y]\" r=\"8\" fill=\"red\" /&gt;\n";
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
  &lt;/svg&gt;
  &lt;/td&gt;
...
</code>
</pre>
      </div>

      <p>sesiones-1-05-2.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2782;</span>
// Se accede a la sesión
session_name("sesiones-1-05");
session_start();

// Si alguna posición no está guardada en la sesión, las pone a cero
if (!isset($_SESSION["x"]) || !isset($_SESSION["y"])) {<span class="numero-circulo">&#x2783;</span>
    $_SESSION["x"] = $_SESSION["y"] = 0;
}

// Funciones auxiliares
function recoge($var)<span class="numero-circulo">&#x2780;</span>
{
    $tmp = (isset($_REQUEST[$var]))
    ? trim(htmlspecialchars($_REQUEST[$var], ENT_QUOTES, "UTF-8"))
    : "";
    return $tmp;
}

// Recogida de accion
$accion   = recoge("accion");
$accionOk = true;

// Comprobación de accion
if ($accion != "centro" && $accion != "izquierda" && $accion != "derecha"
    && $accion != "arriba" && $accion != "abajo") {
    // Si no es una de las tres posibles acciones, se vuelve al formulario
    header("Location:sesiones-1-05-1.php");
    exit;
} else {
    $accionOk = true;
}

// Si la accion recibibida es válida ...
if ($accionOk) {
    //se mueve el punto
    if ($accion == "centro") {<span class="numero-circulo">&#x2781;</span>
        $_SESSION["x"] = $_SESSION["y"] = 0;
    } elseif ($accion == "izquierda") {
        $_SESSION["x"] -= 20;
    } elseif ($accion == "derecha") {
        $_SESSION["x"] += 20;
    } elseif ($accion == "arriba") {
        $_SESSION["y"] -= 20;
    } elseif ($accion == "abajo") {
        $_SESSION["y"] += 20;
    }

    // si sale por un lado, entra por el otro
    if ($_SESSION["x"] &gt; 200) {<span class="numero-circulo">&#x2788;</span>
        $_SESSION["x"] = -200;
    } elseif ($_SESSION["x"] &lt; -200) {
        $_SESSION["x"] = 200;
    }

    // si sale por un lado, entra por el otro
    if ($_SESSION["y"] &gt; 200) {
        $_SESSION["y"] = -200;
    } elseif ($_SESSION["y"] &lt; -200) {
        $_SESSION["y"] = 200;
    }

    // y vuelve al formulario
    header("Location:sesiones-1-05-1.php");<span class="numero-circulo">&#x2784;</span>
    exit;
}
?&gt;</code>
</pre>
      </div>
    </section>

    <section id="ejercicio-06">
      <h2>Sesiones (1) 06 - Votar una opción</h2>

      <p>Este ejercicio es muy similar al anterior. La diferencia es que cada valor se utiliza en un dibujo distinto.</p>

      <ol start="0">
        <li>Puesto que la página 2 redirige a la página 1, la página 2 no debe tener nada de HTML, ni ningún <span class="php-res">print</span>.</li>
        <li>Primero, la página 2 debe recoger el dato enviado por el formulario de la página 1. En la página 1 hay 3 botones, pero los tres tienen el mismo <span class="html-atri">name</span>, por lo que sólo hay que recoger un dato.
          <p>No hace falta comprobar el dato porque el programa sólo hará caso de los valores correctos.</p>
        </li>
        <li>Los dos valores que se utilizan en la página 1 se modifican en la página 2, dependiendo del dato recibido (se aumenta uno de ellos o se ponen los dos a cero).</li>
        <li>Para que la página 2 pueda guardar datos en $_SESSION, debemos unir la página a la sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
        <li>Las variables de sesión se deben inicializar antes de modificarlas (la manera más simple de hacerlo es darles valor si no existen).</li>
        <li>Finalmente, la página 2 redirige a la página 1.</li>
        <li>La página 1 constuye la primera imagen SVG utilizando uno de los números guardados en $_SESSION. El número se utiliza en dos sitios.</li>
        <li>La página 1 constuye la segunda imagen SVG utilizando el otro número guardado en $_SESSION. El número se utiliza en dos sitios.</li>
        <li>Para que la página 1 pueda usar datos de $_SESSION, debemos unir la página a la sesión. El nombre de la sesión debe ser el mismo en ambas páginas.</li>
        <li>Pero la primera vez que se abre la página, $_SESSION no contiene ningún dato e intentar imprimirlo provocaría un error, por lo que damos valor a las variables si no existen.</li>
      </ol>
      <p>sesiones-1-06-1.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
// Se accede a la sesión
session_name("sesiones-1-06");<span class="numero-circulo">&#x2787;</span>
session_start();

// Si algún contador no está guardado en la sesión, los pone a cero
if (!isset($_SESSION["a"]) || !isset($_SESSION["b"])) {<span class="numero-circulo">&#x2788;</span>
    $_SESSION["a"] =  $_SESSION["b"] = 0;
}
?&gt;</code>
</pre>
        <pre>
<code class="language-html">
&lt;!DOCTYPE html&gt;
...
      &lt;tr&gt;
        &lt;td style="vertical-align: top;"&gt;&lt;button type="submit" name="accion" value="a" style="font-size: 60px; line-height: 50px; color: hsl(200, 100%, 50%);"&gt;&#x2714;&lt;/button&gt;&lt;/td&gt;
        &lt;td&gt;</code>
</pre>
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2785;</span>
print "          &lt;svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" \n";
print "            width=\"$_SESSION[a]\" height=\"50\"&gt;\n";
print "            &lt;line x1=\"0\" y1=\"25\" x2=\"$_SESSION[a]\" y2=\"25\" stroke=\"hsl(200, 100%, 50%)\" stroke-width=\"50\" /&gt;\n";
print "          &lt;/svg&gt;\n";
?&gt;</code>
</pre>
        <pre>
<code class="language-html">        &lt;/td&gt;
      &lt;tr&gt;
        &lt;td&gt;&lt;button type="submit" name="accion" value="b" style="font-size: 60px; line-height: 50px; color: hsl(35, 100%, 50%)"&gt;&#x2714;&lt;/button&gt;&lt;/td&gt;
        &lt;td&gt;</code>
</pre>
        <pre>
<code class="language-php">&lt;?php<span class="numero-circulo">&#x2786;</span>
print "          &lt;svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" \n";
print "            width=\"$_SESSION[b]\" height=\"50\"&gt;\n";
print "            &lt;line x1=\"0\" y1=\"25\" x2=\"$_SESSION[b]\" y2=\"25\" stroke=\"hsl(35, 100%, 50%)\" stroke-width=\"50\" /&gt;\n";
print "          &lt;/svg&gt;\n";
?&gt;</code>
</pre>
        <pre>
<code class="language-html">        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
...
</code>
</pre>
      </div>

      <p>sesiones-1-06-2.php</p>

      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
session_name("sesiones-1-06");<span class="numero-circulo">&#x2782;</span>
session_start();

if (!isset($_SESSION["a"]) || !isset($_SESSION["b"])) {<span class="numero-circulo">&#x2783;</span>
    $_SESSION["a"] =  $_SESSION["b"] = 0;
}

function recoge($var)<span class="numero-circulo">&#x2780;</span>
{
    $tmp = (isset($_REQUEST[$var]))
    ? trim(htmlspecialchars($_REQUEST[$var], ENT_QUOTES, "UTF-8"))
    : "";
    return $tmp;
}

$accion = recoge("accion");

if ($accion == "a") {<span class="numero-circulo">&#x2781;</span>
    $_SESSION["a"] += 10;
} elseif ($accion == "b") {
    $_SESSION["b"] += 10;
} elseif ($accion == "cero") {
    $_SESSION["a"] = $_SESSION["b"] = 0;
}

header("Location:sesiones-1-06-1.php");<span class="numero-circulo">&#x2784;</span>
?&gt;</code>
</pre>
      </div>
    </section>
  </section>

  <footer>
    <p class="ultmod">Última modificación de esta página: 10 de noviembre de 2017</p>

    <p class="licencia">
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES"><img src="../../varios/iconos/icono-cc-by-sa.svg" alt="Licencia Creative Commons" title="Licencia Creative Commons BY-SA" width="120" height="42" /></a><br />
      Esta página forma parte del curso <strong><a href="http://www.mclibre.org/consultar/php/">Programación web en PHP</a></strong> por <a href="http://www.mclibre.org/" rel="author">Bartolomé Sintes Marco</a><br />
      que se distribuye bajo una <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES">Licencia Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional (CC BY-SA 4.0)</a>.
    </p>
  </footer>
</body>
</html>
