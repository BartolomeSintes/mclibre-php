<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Identificación de usuarios. Comentarios. Ejercicios. PHP. Bartolomé Sintes Marco. www.mclibre.org</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../../varios/php.css" title="mclibre">
  <link rel="icon" href="../../../varios/favicon.svg">
  <link rel="stylesheet" href="../../../varios/prism.css">
  <script src="../../../varios/prism.js"></script>
</head>

<body>
  <h1>Ejercicios - Bases de datos (3) - Identificación de usuarios - Ayuda</h1>

  <nav>
    <p>
      <a href="../../../index.html"><img src="../../../varios/iconos/icono-php.svg" alt="Índice de PHP" title="Índice de PHP" width="48" height="48"></a>
      <a href="#"><img src="../../../varios/iconos/icono-arrow-circle-up.svg" alt="Principio de la página" title="Principio de la página" width="36" height="36"></a>
    </p>

    <div class="toc">
      <h2>Bases de datos (3) - Ayuda</h2>

      <h3><a href="index.html">Enunciados</a></h3>
      <ul>
        <li><a href="index.html#ejercicio-1">1 - Identificación automática</a></li>
        <li><a href="index.html#ejercicio-2">2 - Usuario único</a></li>
        <li><a href="index.html#ejercicio-3">3 - Tabla de usuarios</a></li>
        <li><a href="index.html#ejercicio-4">4 - Categorías de usuarios</a></li>
      </ul>

      <h3><a href="#">Ayuda</a></h3>
      <ul>
        <li><a href="#ejercicio-1">1 - Identificación automática</a></li>
        <li><a href="#ejercicio-2">2 - Usuario único</a></li>
        <li><a href="#ejercicio-3">3 - Tabla de usuarios</a></li>
        <li><a href="#ejercicio-4">4 - Categorías de usuarios</a></li>
      </ul>
    </div>
  </nav>

  <p>Esta página contiene comentarios ampliados con fragmentos de código PHP de los ejercicios <a href="index.html">Base de datos (3) Identificación de usuarios</a>.</p>

  <section id="ejercicio-1">
    <h2>Bases de datos (3) 1 - Identificación automática</h2>

    <p>En todo estos ejercicios, las páginas de gestión de la tabla deben mostrarse únicamente a los usuarios identificados. En este primer ejercicio, la identificación es automática, no se necesita indicar ningún nombre de usuario ni contraseña.</p>

    <ul>
      <li>Organice los ficheros en directorios:
        <ul>
          <li>acceso: gestión de la identificación del usuario (login.php, logout.php)</li>
          <li>comunes: configuración, bibliotecas, bases de datos y hoja de estilo (biblioteca.php, biblioteca-mysql.php, biblioteca-sqlite.php, config.php, mclibre-php-proyectos.css)</li>
          <li>tabla-personas: páginas específicas para gestionar la tabla personas (borrar-1.php, borrar-2.php, borrar-todo-1.php, borrar-todo-2.php, buscar-1.php, buscar-2.php, index.php, insertar-1.php, insertar-2.php, listar.php, modificar-1.php, modificar-2.php, modificar-3.php)</li>
          <li>img: flechas de ordenación (abajo.svg, arriba.svg)</li>
          <li>directorio raíz: incluye únicamente la página inicial index.php</li>
        </ul>
      </li>
      <li>Identificación
        <ul>
          <li>La identificación se realiza mediante sesiones.</li>
          <li>[login.php] Al identificarse correctamente el usuario, establecemos una variable de sesión y redirigimos a la página principal. En este primer ejercicio, la identificación es automática, es decir, al entrar en login.php, la variable de sesión se establece siempre
            <div class="codigo">
              <pre>
<code class="language-php">session_name($cfg["sessionName"]);
session_start();

$_SESSION["conectado"] = true;

header("location:../index.php");</code>
</pre>
            </div>
          </li>
          <li>[varias] En las páginas que sólo queremos mostrar al usuario identificado, comprobamos que la variable de sesión existe y si no existe, redirigimos a la página principal.
            <div class="codigo">
              <pre>
<code class="language-php">session_name($cfg["sessionName"]);
session_start();

if (!isset($_SESSION["conectado"])) {
    header("Location:../index.php");
    exit;
}</code>
</pre>
            </div>
          </li>
          <li>[logout.php] Para desconectar al usuario, simplemente destruimos la sesión.
            <div class="codigo">
              <pre>
<code class="language-php">session_name($cfg["sessionName"]);
session_start();

session_destroy();

header("location:../index.php");</code>
</pre>
            </div>
          </li>
          <li>[config.php] El nombre de la sesión se define para todas las páginas.
            <div class="codigo">
              <pre>
<code class="language-php">// Nombre de sesión

$cfg["sessionName"] = "mclibre-bases-de-datos-3-1";         // Nombre de sesión</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
      <li>Menús
        <ul>
          <li>[config.php] Definimos las constantes PROFUNDIDAD_N y MENU_XXX.
            <div class="codigo">
              <pre>
<code class="language-php">// Constantes y variables configurables por el programador de la aplicación

define("MENU_PRINCIPAL", 1);                // Menú principal sin conectar
define("MENU_VOLVER", 2);                   // Menú Volver a inicio
define("MENU_PERSONAS", 3);                 // Menú Personas

define("PROFUNDIDAD_0", 0);                 // Profundidad de nivel de la página: directorio raíz
define("PROFUNDIDAD_1", 1);                 // Profundidad de nivel de la página: subdirectorio</code>
</pre>
            </div>
          </li>
          <li>[biblioteca.php] Al organizar los ficheros en directorios, el enlace a la hoja de estilo no es el mismo dependiendo de si la página está en un directorio o en el directorio raíz. Podemos añadir un tercer argumento a la función cabecera para indicar la profundidad en la que se encuentra la página.
            <div class="codigo">
              <pre>
<code class="language-php">function cabecera($texto, $menu, $profundidadDirectorio)
{
    ...
    if ($profundidadDirectorio == PROFUNDIDAD_0) {
        print "  &lt;link rel=\"stylesheet\" <span class="codigo-resaltado">href=\"comunes/</span>mclibre-php-proyectos.css\" title=\"Color\" /&gt;\n";
    } elseif ($profundidadDirectorio == PROFUNDIDAD_1) {
        print "  &lt;link rel=\"stylesheet\" <span class="codigo-resaltado">href=\"../comunes/</span>mclibre-php-proyectos.css\" title=\"Color\" /&gt;\n";
    }
    ...</code>
</pre>
            </div>
          </li>
          <li>[varias] Todas las llamadas a la función cabecera() deberán incluir el tercer argumento:
            <div class="codigo">
              <pre>
<code class="language-php">cabecera("Borrar 1", MENU_PERSONAS, PROFUNDIDAD_1);</code>
</pre>
            </div>
          </li>
          <li>[index.php] La página inicial muestra menús distintos, dependiendo de si el usuario está conectado o no:
            <div class="codigo">
              <pre>
<code class="language-php">cabecera("Inicio", MENU_PRINCIPAL, PROFUNDIDAD_0);</code>
</pre>
            </div>
            <p>[biblioteca.php] En un caso el menú permite gestionar la tabla personas y en el otro no:</p>
            <div class="codigo">
              <pre>
<code class="language-php">    if (!isset($_SESSION["conectado"])) {
        if ($menu == MENU_PRINCIPAL) {
            print "        &lt;li&gt;&lt;a href=\"acceso/login.php\"&gt;Conectarse&lt;/a&gt;&lt;/li&gt;\n";
        } else {
            print "        &lt;li&gt;Error en la selección de menú&lt;/li&gt;\n";
        }
    } else {
        if ($menu == MENU_PRINCIPAL) {
            print "        &lt;li&gt;&lt;a href=\"tabla-personas/index.php\"&gt;Personas&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"acceso/logout.php\"&gt;Desconectarse&lt;/a&gt;&lt;/li&gt;\n";
        } elseif ($menu == MENU_VOLVER) {
            print "        &lt;li&gt;&lt;a href=\"../index.php\"&gt;Volver&lt;/a&gt;&lt;/li&gt;\n";
        } elseif ($menu == MENU_PERSONAS) {
            print "        &lt;li&gt;&lt;a href=\"../index.php\"&gt;Volver&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"insertar-1.php\"&gt;Añadir registro&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"listar.php\"&gt;Listar&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"borrar-1.php\"&gt;Borrar&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"buscar-1.php\"&gt;Buscar&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"modificar-1.php\"&gt;Modificar&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"borrar-todo-1.php\"&gt;Borrar todo&lt;/a&gt;&lt;/li&gt;\n";
        } else {
            print "        &lt;li&gt;Error en la selección de menú&lt;/li&gt;\n";
        }
    }</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
      <li>tabla-personas
        <ul>
          <li>[todas en /tabla-personas] Todas las páginas de la gestión de la tabla de personas tienen un menú específico:
            <div class="codigo">
              <pre>
<code class="language-php">cabecera("Inicio", MENU_PERSONAS, PROFUNDIDAD_1);</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
    </ul>
  </section>

  <section id="ejercicio-2">
    <h2>Bases de datos (3) 2 - Usuario único</h2>

    <p>En este ejercicio, el usuario debe identificarse indicando su nombre y contraseña, pero sólo existe un usuario, con nombre y contraseña fijos. La contraseña de este usuario no se guarda directamente, lo que se guarda es un <i>hash</i> de la contraseña.</p>

    <ul>
      <li>Identificación
        <ul>
          <li>[config.php] El usuario único se define en el fichero de configuración:
            <div class="codigo">
              <pre>
<code class="language-php">// Usuario de la aplicación

$cfg["rootName"]      = "root";                             // Nombre del Usuario Administrador de la aplicación
$cfg["rootPassword"]  = "4813494d137e1631bba301d5acab6e7bb7aa74ce1185d456565ef51d737677b2";  // Contraseña encriptada del Usuario Administrador de la aplicación</code>
</pre>
            </div>
          </li>
          <li>[biblioteca.php] El <i>hash</i> se calcula en una función:
            <div class="codigo">
              <pre>
<code class="language-php">function encripta($cadena)
{
    global $cfg;

    return hash($cfg["hashAlgorithm"], $cadena);
}</code>
</pre>
            </div>
          </li>
          <li>[config.php] El tipo de <i>hash</i> se define en el fichero de configuración:
            <div class="codigo">
              <pre>
<code class="language-php">// Algoritmo hash para encriptar la contraseña de usuario

$cfg["hashAlgorithm"] = "sha256";  // Algoritmo hash para encriptar la contraseña de usuario
                                   // Los posibles algoritmos son https://www.php.net/manual/en/function.hash-algos.php</code>
</pre>
            </div>
          </li>
          <li>login-1.php y login-2.php
            <p>En este ejercicio el login se divide en dos páginas. La primera es un formulario que pide el nombre de usuario y la contraseña. La segunda página comprueba si los datos introducidos coinciden con los del fichero de configuración.</p>
            <div class="codigo">
              <pre>
<code class="language-php">$usuario  = recoge("usuario");
$password = recoge("password");

if ($usuario != $cfg["rootName"] || encripta($password) != $cfg["rootPassword"]) {
    header("Location:login-1.php?aviso=Error: Nombre de usuario y/o contraseña incorrectos");
    exit;
}

$_SESSION["conectado"] = true;

header("Location:../index.php");

exit;</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
    </ul>
  </section>

  <section id="ejercicio-3">
    <h2>Bases de datos (3) 3 - Tabla de usuarios</h2>

    <p>En este ejercicio se deben poder crear muchos usuarios distintos, con su nombre y contraseña. Todos los usuarios pueden realizar las mismas acciones.</p>

    <ul>
      <li>Tabla de usuarios
        <ul>
          <li>Necesitamos definir otra tabla en la base de datos, para guardar los nombres y contraseñas de los usuarios.</li>
          <li>[config.php] Los tamaños de los campos se definen en el fichero de configuración:
            <p>Definimos dos tamaños de contraseña: el tamaño del control que el usuario escribe en el formulario y el tamaño del <i>hash</i> que se guarda en la base de datos</p>
            <div class="codigo">
              <pre>
<code class="language-php">// Tamaño de los campos en la tabla Usuarios

$cfg["dbUsuariosTamUsuario"]  = 20;                         // Tamaño de la columna Usuarios &gt; Nombre de usuario
$cfg["dbUsuariosTamPassword"] = 64;                         // Tamaño de la columna Usuarios &gt; Contraseña de usuario (cifrada)

// Tamaño de los controles en los formularios

$cfg["formUsuariosTamUsuario"]  = $cfg["dbUsuariosTamUsuario"];     // Tamaño de la caja de texto Usuario &gt; Nombre de usuario
$cfg["formUsuariosTamPassword"] = 20;                               // Tamaño de la caja de texto Usuario &gt; Contraseña</code>
</pre>
            </div>
          </li>
          <li>[biblioteca-sqlite.php]
            <p>Modificamos la función borraTodo() para que borre y cree todas las tablas.</p>
            <p>Una vez creadas las tablas, insertaremos un registro en la tabla de usuarios para que haya algún usuario que pueda conectarse. Los datos de ese usuario se encuentran como antes en el archivo de configuración. Indicaremos el campo <i>id</i> para asegurar el valor del campo. En este caso, no es algo estrictamente necesario, pero sí que lo sería si insertáramos registros que estuvieran relacionados con registros de otras tablas (como haremos más adelante).</p>
            <div class="codigo">
              <pre>
<code class="language-php">function borraTodo()
{
    ...
    $consulta = "DROP TABLE IF EXISTS $cfg[dbUsuariosTabla]";
    ...
    $consulta = "DROP TABLE IF EXISTS $cfg[dbPersonasTabla]";
    ...
    $consulta = "CREATE TABLE $cfg[dbUsuariosTabla]  (
                 id INTEGER PRIMARY KEY,
                 usuario VARCHAR($cfg[dbUsuariosTamUsuario]),
                 password VARCHAR($cfg[dbUsuariosTamPassword])
                 )";
    ...
        $consulta = "INSERT INTO $cfg[dbUsuariosTabla]
                     (id, usuario, password)
                     VALUES (1, '$cfg[rootName]', '$cfg[rootPassword]')";
    ...
    $consulta = "CREATE TABLE $cfg[dbPersonasTabla]  (
                 id INTEGER PRIMARY KEY,
                 nombre VARCHAR($cfg[dbPersonasTamNombre]) COLLATE NOCASE,
                 apellidos VARCHAR($cfg[dbPersonasTamApellidos]) COLLATE NOCASE,
                 telefono VARCHAR($cfg[dbPersonasTamTelefono]) COLLATE NOCASE,
                 correo VARCHAR($cfg[dbPersonasTamCorreo]) COLLATE NOCASE
                 )";
}</code>
</pre>
            </div>
            <p>Añadimos la información sobre la tabla de usuarios</p>
            <div class="codigo">
              <pre>
<code class="language-php">// SQLITE: Nombres de las tablas

$cfg["dbPersonasTabla"] = "personas";                       // Nombre de la tabla Personas
$cfg["dbUsuariosTabla"] = "usuarios";                       // Nombre de la tabla Usuarios</code>
</pre>
            </div>
          </li>
          <li>[biblioteca-mysql.php]
            <p>Modificaríamos esta biblioteca de forma similar.</p>
            <div class="codigo">
              <pre>
<code class="language-php">function borraTodo()
{
    ...
    $consulta = "DROP DATABASE IF EXISTS $cfg[mysqlDatabase]";
    ...
    $consulta = "CREATE DATABASE $cfg[mysqlDatabase]
                 CHARACTER SET utf8mb4
                 COLLATE utf8mb4_unicode_ci";
    ...
    $consulta = "CREATE TABLE $cfg[dbUsuariosTabla]  (
                 id INTEGER UNSIGNED AUTO_INCREMENT,
                 usuario VARCHAR($cfg[dbUsuariosTamUsuario]),
                 password VARCHAR($cfg[dbUsuariosTamPassword]),
                 PRIMARY KEY(id)
                 )";
    ...
    $consulta = "INSERT INTO $cfg[dbUsuariosTabla]
                 (usuario, password)
                 VALUES ($cfg[rootName]', '$cfg[rootPassword]')";
    ...
    $consulta = "CREATE TABLE $cfg[dbPersonasTabla]  (
                 id INTEGER UNSIGNED AUTO_INCREMENT,
                 nombre VARCHAR($cfg[dbPersonasTamNombre]),
                 apellidos VARCHAR($cfg[dbPersonasTamApellidos]),
                 telefono VARCHAR($cfg[dbPersonasTamTelefono]),
                 correo VARCHAR($cfg[dbPersonasTamCorreo]),
                 PRIMARY KEY(id)
                 )";
}</code>
</pre>
            </div>
          </li>
          <li>[biblioteca.php] Definimos los posibles valores de ordenación
            <div class="codigo">
              <pre>
<code class="language-php">// Valores de ordenación de la tabla

$cfg["dbPersonasColumnasOrden"] = [
    "nombre ASC", "nombre DESC",
    "apellidos ASC", "apellidos DESC",
    "telefono ASC", "telefono DESC",
    "correo ASC", "correo DESC",
];

$cfg["dbUsuariosColumnasOrden"] = [
    "usuario ASC", "usuario DESC",
    "password ASC", "password DESC",
];</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
      <li>Administrador
        <p>Crearemos una carpeta /administrador y moveremos las páginas borrar-todo-1.php y borrar-todo-2.php a esa carpeta (habrá modificar los menús).</p>
        <div class="codigo">
          <pre>
<code class="language-php">
    } elseif ($menu == MENU_ADMINISTRADOR) {
        print "        &lt;li&gt;&lt;a href=\"../index.php\"&gt;Volver&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"borrar-todo-1.php\"&gt;Borrar todo&lt;/a&gt;&lt;/li&gt;\n";
    } elseif ($menu == MENU_USUARIOS) {
        print "        &lt;li&gt;&lt;a href=\"../../index.php\"&gt;Volver&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"insertar-1.php\"&gt;Añadir registro&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"listar.php\"&gt;Listar&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"borrar-1.php\"&gt;Borrar&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"buscar-1.php\"&gt;Buscar&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"modificar-1.php\"&gt;Modificar&lt;/a&gt;&lt;/li&gt;\n";
    } elseif ($menu == MENU_PERSONAS) {
        print "        &lt;li&gt;&lt;a href=\"../../index.php\"&gt;Volver&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"insertar-1.php\"&gt;Añadir registro&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"listar.php\"&gt;Listar&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"borrar-1.php\"&gt;Borrar&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"buscar-1.php\"&gt;Buscar&lt;/a&gt;&lt;/li&gt;\n";
        print "        &lt;li&gt;&lt;a href=\"modificar-1.php\"&gt;Modificar&lt;/a&gt;&lt;/li&gt;\n";
    } else {
        ...</code>
</pre>
        </div>
      </li>
      <li>Tabla Usuarios y tabla Personas
        <ul>
          <li>Crearemos dos carpetas /db/tabla-personas y db/tabla-usuarios con las mismas páginas de gestión de la tabla (insertar-1.php, insertar-2.php, etc.), pero adaptando los nombres de los campos a los de la tabla correspondiente.</li>
          <li>[config.php]
            <p>Añadimos una variable de configuración para permitir o no modificar la contraseña del usuario Administrador:</p>
            <div class="codigo">
              <pre>
<code class="language-php">$cfg["rootPasswordModificable"] = false;                    // Contraseña del usuario Administrador se puede cambiar o no</code>
</pre>
            </div>
          </li>
          <li>[biblioteca.php]
            <p>Debermos definir un nivel más de profundidad:</p>
            <div class="codigo">
              <pre>
<code class="language-php">define("PROFUNDIDAD_0", 0);                 // Profundidad de nivel de la página: directorio raíz
define("PROFUNDIDAD_1", 1);                 // Profundidad de nivel de la página: subdirectorio
define("PROFUNDIDAD_2", 2);                 // Profundidad de nivel de la página: sub-subdirectorio</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
      <li>Tabla Usuarios
        <ul>
          <li>En la tabla usuarios hay que realizar algunas comprobaciones adicionales en algunas páginas.</li>
          <li>[insertar-2.php]
            <p>Para insertar un registro de usuario, el campo nombre de usuario es obligatorio:</p>
            <div class="codigo">
              <pre>
<code class="language-php">if ($usuario == "") {
    print "    &lt;p class=\"aviso\"&gt;Hay que escribir un nombre de usuario.&lt;/p&gt;\n";
    print "\n";
} elseif (mb_strlen($usuario, "UTF-8") &gt; $cfg["dbUsuariosTamUsuario"]) {
    print "    &lt;p class=\"aviso\"&gt;El nombre de usuario no puede tener más de $cfg[dbUsuariosTamUsuario] caracteres.&lt;/p&gt;\n";
    print "\n";
} else {
    $usuarioOk = true;
}</code>
</pre>
            </div>
            <p>No puede haber dos usuarios con el mismo nombre de usuario:</p>
            <div class="codigo">
              <pre>
<code class="language-php">    $consulta = "SELECT COUNT(*) FROM $cfg[dbUsuariosTabla]
                 WHERE usuario = :usuario";

    $resultado = $pdo-&gt;prepare($consulta);
    if (!$resultado) {
        print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
    } elseif (!$resultado-&gt;execute([":usuario" =&gt; $usuario])) {
        print "    &lt;p class=\"aviso\"&gt;Error al ejecutar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
    } elseif ($resultado-&gt;fetchColumn() &gt; 0) {
        print "    &lt;p class=\"aviso\"&gt;Ya existe un usuario con ese nombre.&lt;/p&gt;\n";
    } else {
      ...</code>
</pre>
            </div>

            <p>En la tabla guardamos la contraseña encriptada:</p>
            <div class="codigo">
              <pre>
<code class="language-php">            $consulta = "INSERT INTO $cfg[dbUsuariosTabla]
                         (usuario, password)
                         VALUES (:usuario, :password)";

            $resultado = $pdo-&gt;prepare($consulta);
            if (!$resultado) {
                print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
            } elseif (!$resultado-&gt;execute([":usuario" =&gt; $usuario, ":password" =&gt; encripta($password)])) {
                print "    &lt;p class=\"aviso\"&gt;Error al ejecutar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
            } else {
                print "    &lt;p&gt;Registro creado correctamente.&lt;/p&gt;\n";
            }</code>
</pre>
            </div>
          </li>
          <li>[borrar-2.php]
            <p>El usuario inicial no se puede borrar (esto no es estrictamente necesario, pero yo lo hago para que la aplicación que tengo incluida en la página de ejercicios de los apuntes esté siempre accesible a los visitantes de la web):</p>
            <div class="codigo">
              <pre>
<code class="language-php">    foreach ($id as $indice =&gt; $valor) {
        $consulta = "SELECT * FROM $cfg[dbUsuariosTabla]
                     WHERE id = :indice";

        $resultado = $pdo-&gt;prepare($consulta);
        if (!$resultado) {
            print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
        } elseif (!$resultado-&gt;execute([":indice" =&gt; $indice])) {
            print "    &lt;p class=\"aviso\"&gt;Error al ejecutar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
        } elseif (!($registro = $resultado-&gt;fetch())) {
            print "    &lt;p class=\"aviso\"&gt;Registro no encontrado.&lt;/p&gt;\n";
        } elseif ($registro["usuario"] == $cfg["rootName"]) {
            print "    &lt;p class=\"aviso\"&gt;Este usuario no se puede borrar.&lt;/p&gt;\n";
        } else {
            ...</code>
</pre>
            </div>
          </li>
          <li>[buscar-1.php y buscar-2.php]
            <p>No se incluye el campo contraseña en el formulario. Buscar por contraseña no tiene demasiado sentido porque en la base de datos se guarda el <i>hash</i> de la contraseña.</p>
            <p>El único motivo para buscar por contraseñas podría ser para ver qué usuarios tienen la contraseña en blanco (o contraseñas triviales como 1234, por ejemplo). Pero como la búsqueda tiene en cuenta todos los campos, incluir la contraseña en la búsqueda reduce completamente los resultados de la búsqueda.</p>
          </li>
          <li>[modificar-2.php]
            <p>El nombre del Administrador inicial no se puede cambiar (su nombre se establece en la variable de configuración $cfg["rootName"]). Su contraseña se puede cambiar o no dependiendo del valor de la variable de configurtación $cfg["rootPasswordModificable"] (<span class="php-con">true</span> o <span class="php-con">false</span>). El bloqueo del cambio de contraseña lo he incluido para que la aplicación que tengo incluida en la página de ejercicios de los apuntes esté siempre accesible a los visitantes de la web:</p>
            <div class="codigo">
              <pre>
<code class="language-php">    $consulta = "SELECT * FROM $cfg[dbUsuariosTabla]
                 WHERE id = :id";

    $resultado = $pdo-&gt;prepare($consulta);
    if (!$resultado) {
        print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
    } elseif (!$resultado-&gt;execute([":id" =&gt; $id])) {
        print "    &lt;p class=\"aviso\"&gt;Error al ejecutar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
    } elseif (!($registro = $resultado-&gt;fetch())) {
        print "    &lt;p class=\"aviso\"&gt;Registro no encontrado.&lt;/p&gt;\n";
    } elseif ($registro["usuario"] == $cfg["rootName"] && !$cfg["rootPasswordModificable"]) {
        print "    &lt;p class=\"aviso\"&gt;Este usuario no se puede modificar.&lt;/p&gt;\n";
    } else {
              ...</code>
</pre>
            </div>
            <p>Al mostrar los valores de los campos, el campo nivel es un menú <span class="html-eti">&lt;select&gt;</span>. Para que se muestre la opción correspondiente al nivel actual del usuario debemos añadir el atributo <span class="html-atri">selected</span> al <span class="html-eti">&lt;option&gt;</span> correspondiente:</p>
            <div class="codigo">
              <pre>
<code class="language-php">        foreach ($cfg["usuariosNiveles"] as $indice =&gt; $valor) {
            if ($registro["nivel"] == $indice) {
                print "                &lt;option value=\"$indice\" selected&gt;$valor&lt;/option&gt;\n";
            } else {
                print "                &lt;option value=\"$indice\"&gt;$valor&lt;/option&gt;\n";
            }
        }</code>
</pre>
            </div>
          </li>
          <li>[modificar-3.php]
            <p>Al cambiar el nombre del usuario hay que comprobar antes que el nuevo nombre no esté ya registrado</p>
            <div class="codigo">
              <pre>
<code class="language-php">        // La consulta cuenta los registros con un id diferente porque MySQL no distingue
        // mayúsculas de minúsculas y si en un registro sólo se cambian mayúsculas por
        // minúsculas MySQL diría que ya hay un registro como el que se quiere guardar.
        $consulta = "SELECT COUNT(*) FROM $cfg[dbUsuariosTabla]
                     WHERE usuario = :usuario
                     AND id&lt;&gt;:id";

        $resultado = $pdo-&gt;prepare($consulta);
        if (!$resultado) {
            print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
        } elseif (!$resultado-&gt;execute([":usuario" =&gt; $usuario, ":id" =&gt; $id])) {
            print "    &lt;p class=\"aviso\"&gt;Error al ejecutar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
        } elseif ($resultado-&gt;fetchColumn() &gt; 0) {
            print "    &lt;p class=\"aviso\"&gt;Ya existe un registro con esos mismos valores. "
                . "No se ha guardado la modificación.&lt;/p&gt;\n";
        } else {
          ...</code>
</pre>
            </div>
            <p>El nombre del Administrador inicial no se puede cambiar y la contraseña solo puede cambiarse si la variable de configurtación $cfg["rootPasswordModificable"] es <span class="php-con">true</span>.:</p>
            <div class="codigo">
              <pre>
<code class="language-php">            $consulta = "SELECT * FROM $cfg[dbUsuariosTabla]
                         WHERE id = :id";

            $resultado = $pdo-&gt;prepare($consulta);
            if (!$resultado) {
                print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
            } elseif (!$resultado-&gt;execute([":id" =&gt; $id])) {
                print "    &lt;p class=\"aviso\"&gt;Error al ejecutar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
            } else {
                $registro = $resultado-&gt;fetch();
                if ($registro["usuario"] == $cfg["rootName"] && (!$cfg["rootPasswordModificable"] || $registro["usuario"] != $usuario)) {
                    print "    &lt;p class=\"aviso\"&gt;Del usuario Administrador inicial sólo se puede cambiar la contraseña.&lt;/p&gt;\n";
                } else {
              ...</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
      <li>Puesta en marcha
        <ul>
          <li>Normalmente, las aplicaciones web tienen un directorio con los scripts de instalación. Estos scripts se ejecutan una vez y crean la base de datos. A continuación se suele pedir al administrador que borre ese directorio puesto que la aplicación ya no necesita volver a ejecutar esos scripts. En este ejercicio se resuelve la instalación de otra manera: cada vez que se entra en la página login-1.php se comprueba si la base de datos existe. Hago esto porque la aplicación guarda la base de datos en un directorio temporal que de vez en cuando el servidor vacía automáticamente.</li>
          <li>[biblioteca-sqlite.php] Esta es la función que detecta si no existe la base de datos en SQLite:
            <div class="codigo">
              <pre>
<code class="language-php">function existenTablas()
{
    global $pdo, $cfg;

    $existe = true;

    foreach ($cfg["dbTablas"] as $tabla) {
        $consulta = "SELECT COUNT(*) FROM sqlite_master WHERE type = 'table' AND name = '$tabla'";

        $resultado = $pdo-&gt;query($consulta);
        if (!$resultado) {
            $existe = false;
            print "    &lt;p class=\"aviso\"&gt;Error en la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
            print "\n";
        } else {
            if ($resultado-&gt;fetchColumn() == 0) {
                $existe = false;
            }
        }
    }
    return $existe;
}</code>
</pre>
            </div>
          </li>
          <li>[biblioteca-mysql.php] Esta es la función que detecta si no existe la base de datos en MySQL:
            <div class="codigo">
              <pre>
<code class="language-php">function existenTablas()
{
    global $pdo, $cfg;

    $existe = true;

    $consulta = "SELECT COUNT(*) FROM information_schema.schemata WHERE schema_name = '$cfg[mysqlDatabase]'";

    $resultado = $pdo-&gt;query($consulta);
    if (!$resultado) {
        $existe = false;
        print "    &lt;p class=\"aviso\"&gt;Error en la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
        print "\n";
    } else {
        if ($resultado-&gt;fetchColumn() == 0) {
            $existe = false;
        } else {
            foreach ($cfg["dbTablas"] as $tabla) {
                // En information_schema.tables los nombres de las tablas no llevan el nombre
                // de la base de datos, así que lo elimino
                $tabla = str_replace("$cfg[mysqlDatabase].", "", $tabla);

                $consulta = "SELECT COUNT(*) FROM information_schema.tables
                             WHERE table_schema = '$cfg[mysqlDatabase]'
                             AND table_name = '$tabla'";

                $resultado = $pdo-&gt;query($consulta);
                if (!$resultado) {
                    $existe = false;
                    print "    &lt;p class=\"aviso\"&gt;Error en la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
                    print "\n";
                } else {
                    if ($resultado-&gt;fetchColumn() == 0) {
                        $existe = false;
                    }
                }
            }
        }
    }
    return $existe;
}</code>
</pre>
            </div>
          </li>
          <li>[login-1.php] Al entrar a identificarse, se comprueba si existen la base de datos y las tablas. Si no existen, se crean de nuevo.
            <div class="codigo">
              <pre>
<code class="language-php">if (!existenTablas()) {
    print "&lt;p&gt;La base de datos no está creada. Se creará la base de datos.&lt;/p&gt;\n";
    print "\n";
    borraTodo();
}</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
    </ul>
  </section>

  <section id="ejercicio-4">
    <h2>Bases de datos (3) 4 - Categorías de usuarios</h2>

    <p>En este ejercicio se deben definir dos categorías de usuarios:</p>
    <ul>
      <li>Los usuarios administradores tienen acceso a todas las opciones de la aplicación.</li>
      <li>Los usuarios básicos sólo tiene acceso a la tabla de Personas.</li>
    </ul>

    <hr class="corta">

    <ul>
      <li>Tabla de usuarios
        <ul>
          <li>[biblioteca.php] Definimos dos niveles de usuario y en una matriz hacemos corresponder el texto que aparece en pantalla con el valor del nivel en la base de datos. Es importante que los niveles vayan en orden numérico creciente porque en la comprobación de niveles se hacen comparaciones con desigualdades.
            <div class="codigo">
              <pre>
<code class="language-php">define("NIVEL_USUARIO_BASICO", 10);         // Usuario web de nivel Usuario Básico
define("NIVEL_ADMINISTRADOR", 20);          // Usuario web de nivel Administrador

// Niveles de usuario

$cfg["usuariosNiveles"] = [
    NIVEL_USUARIO_BASICO =&gt; "Usuario Básico",
    NIVEL_ADMINISTRADOR =&gt; "Administrador",
];</code>
</pre>
            </div>

            <p>Añadimos el campo nivel en los posibles valores de ordenación de la tabla Usuarios.</p>
            <div class="codigo">
              <pre>
<code class="language-php">$cfg["dbUsuariosColumnasOrden"] = [
    "usuario ASC", "usuario DESC",
    "password ASC", "password DESC",
    "nivel ASC", "nivel DESC",
];</code>
</pre>
            </div>
          </li>
          <li>[biblioteca-sqlite.php] Añadimos un campo más a la tabla que indique el nivel del usuario y al crear el registro de usuario inicial le damos nivel de administrador:
            <div class="codigo">
              <pre>
<code class="language-php">    $consulta = "CREATE TABLE $cfg[dbUsuariosTabla]  (
                 id INTEGER PRIMARY KEY,
                 usuario VARCHAR($cfg[dbUsuariosTamUsuario]),
                 password VARCHAR($cfg[dbUsuariosTamPassword]),
                 nivel INTEGER
                 )";

    if (!$pdo-&gt;query($consulta)) {
        print "    &lt;p class=\"aviso\"&gt;Error al crear la tabla Usuarios. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
    } else {
        print "    &lt;p&gt;Tabla Usuarios creada correctamente.&lt;/p&gt;\n";

        $consulta = "INSERT INTO $cfg[dbUsuariosTabla]
                     (id, usuario, password, nivel)
                     VALUES (1, '$cfg[rootName]', '$cfg[rootPassword]', " . NIVEL_ADMINISTRADOR . ")";
        ...</code>
</pre>
            </div>
          </li>
          <li>[biblioteca-mysql.php] Añadimos un campo más a la tabla que indique el nivel del usuario y al crear el registro de usuario inicial le damos nivel de administrador:
            <div class="codigo">
              <pre>
<code class="language-php">        $consulta = "CREATE TABLE $cfg[dbUsuariosTabla]  (
                     id INTEGER UNSIGNED AUTO_INCREMENT,
                     usuario VARCHAR($cfg[dbUsuariosTamUsuario]),
                     password VARCHAR($cfg[dbUsuariosTamPassword]),
                     nivel INTEGER NOT NULL,
                     PRIMARY KEY(id)
                     )";

        if (!$pdo-&gt;query($consulta)) {
            print "    &lt;p class=\"aviso\"&gt;Error al crear la tabla Usuarios. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
        } else {
            print "    &lt;p&gt;Tabla creada correctamente.&lt;/p&gt;\n";

            $consulta = "INSERT INTO $cfg[dbUsuariosTabla]
                         (id, usuario, password, nivel)
                         VALUES (1, '$cfg[rootName]', '$cfg[rootPassword]', " . NIVEL_ADMINISTRADOR . ")";
            ...</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
      <li>Diferenciación entre los usuarios administradores y normales
        <ul>
          <li>[login-2.php] Si el usuario se identifica correctamente, guardamos otra variable de sesión con el nivel del usuario:
            <div class="codigo">
              <pre>
<code class="language-php">$_SESSION["conectado"] = true;
$_SESSION["nivel"]     = $registro["nivel"];</code>
</pre>
            </div>
          </li>
          <li>En las páginas que sólo deben estar accesibles a los administradores [/administrador, /db/tabla-usuarios], debemos comprobar si la variable de sesión tiene el nivel requerido:
            <div class="codigo">
              <pre>
<code class="language-php">session_name($cfg["sessionName"]);
session_start();

if (!isset($_SESSION["conectado"]) || $_SESSION["nivel"] &lt; NIVEL_ADMINISTRADOR) {
    header("Location:../index.php");
    exit;
}</code>
</pre>
            </div>
            <p>En las páginas accesibles a los usuarios básicos y administradores [/db/tabla-personas] comprobamos si la variable de sesión tiene el nivel requerido (aunque realmente sería suficiente con comprobar que existe $_SESSION["conectado"] pero de esta manera explicitamos el nivel requerido):</p>
            <div class="codigo">
              <pre>
<code class="language-php">session_name($cfg["sessionName"]);
session_start();

if (!isset($_SESSION["conectado"]) || $_SESSION["nivel"] &lt; NIVEL_USUARIO_BASICO) {
    header("Location:../../index.php");
    exit;
}</code>
</pre>
            </div>
          </li>
          <li>[biblioteca.php] En la función cabecera añadimos los menús permitidos al usuario básico:
            <div class="codigo">
              <pre>
<code class="language-php">       ...
    } elseif ($_SESSION["nivel"] == NIVEL_USUARIO_BASICO) {
        if ($menu == MENU_PRINCIPAL) {
            print "        &lt;li&gt;&lt;a href=\"db/tabla-personas/index.php\"&gt;Personas&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"acceso/logout.php\"&gt;Desconectarse&lt;/a&gt;&lt;/li&gt;\n";
        } elseif ($menu == MENU_VOLVER) {
            print "        &lt;li&gt;&lt;a href=\"../index.php\"&gt;Volver&lt;/a&gt;&lt;/li&gt;\n";
        } elseif ($menu == MENU_PERSONAS) {
            print "        &lt;li&gt;&lt;a href=\"../../index.php\"&gt;Volver&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"insertar-1.php\"&gt;Añadir registro&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"listar.php\"&gt;Listar&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"borrar-1.php\"&gt;Borrar&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"buscar-1.php\"&gt;Buscar&lt;/a&gt;&lt;/li&gt;\n";
            print "        &lt;li&gt;&lt;a href=\"modificar-1.php\"&gt;Modificar&lt;/a&gt;&lt;/li&gt;\n";
        } else {
            print "        &lt;li&gt;Error en la selección de menú&lt;/li&gt;\n";
        }
    } elseif ($_SESSION["nivel"] == NIVEL_ADMINISTRADOR) {
      ...
    }</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
      <li>db/tabla-usuarios
        <p>Debemos añadir en las diferentes páginas el campo nivel. Por ejemplo:</p>
        <ul>
          <li>[insertar-1.php] El nivel se puede elegir con un cuadro de selección (que incluya automáticamente todos los niveles, por si en el futuro se incluyen más niveles):
            <div class="codigo">
              <pre>
<code class="language-php">    print "          &lt;tr&gt;\n";
    print "            &lt;td&gt;Nivel:&lt;/td&gt;\n";
    print "            &lt;td&gt;\n";
    print "              &lt;select name=\"nivel\"&gt;\n";
    foreach ($cfg["usuariosNiveles"] as $indice =&gt; $valor) {
        print "                &lt;option value=\"$indice\"&gt;$valor&lt;/option&gt;\n";
    }
    print "              &lt;/select&gt;\n";
    print "            &lt;/td&gt;\n";
    print "          &lt;/tr&gt;\n";</code>
</pre>
            </div>
          </li>
          <li>[insertar-2.php] Hay que comprobar que el nivel es uno de los existentes:
            <div class="codigo">
              <pre>
<code class="language-php">$nivel    = recoge("nivel");
...
$nivelOk    = false;
...
if ($nivel == "") {
    print "    &lt;p class=\"aviso\"&gt;Hay que seleccionar un nivel de usuario.&lt;/p&gt;\n";
    print "\n";
} elseif (!array_key_exists($nivel, $cfg["usuariosNiveles"])) {
    print "    &lt;p class=\"aviso\"&gt;Nivel de usuario incorrecto.&lt;/p&gt;\n";
    print "\n";
} else {
    $nivelOk = true;
}

if ($usuarioOk && $passwordOk && $nivelOk) {
    if ($usuario == "" || $password == "" || $nivel == "") {
        print "    &lt;p&gt;Hay que rellenar todos los campos. No se ha guardado el registro.&lt;/p&gt;\n";
    } else {
        ...
            $consulta = "INSERT INTO $cfg[dbUsuariosTabla]
                         (usuario, password, nivel)
                         VALUES (:usuario, :password, :nivel)";

            $resultado = $pdo-&gt;prepare($consulta);
            if (!$resultado) {
                print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
            } elseif (!$resultado-&gt;execute([":usuario" =&gt; $usuario, ":password" =&gt; encripta($password), ":nivel" =&gt; $nivel])) {
                print "    &lt;p class=\"aviso\"&gt;Error al ejecutar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
            } else {
                print "    &lt;p&gt;Registro creado correctamente.&lt;/p&gt;\n";
            }
        ...</code>
</pre>
            </div>
          </li>
          <li>[listar.php] Al listar se muestra el texto, no el valor numérico del nivel:
            <div class="codigo">
              <pre>
<code class="language-php">...
    foreach ($registros as $registro) {
        print "          &lt;tr&gt;\n";
        print "            &lt;td&gt;$registro[usuario]&lt;/td&gt;\n";
        print "            &lt;td&gt;$registro[password]&lt;/td&gt;\n";
        print "            &lt;td&gt;{$cfg["usuariosNiveles"][$registro["nivel"]]}&lt;/td&gt;\n";
        print "          &lt;/tr&gt;\n";
    }
...</code>
</pre>
            </div>
          </li>
          <li>[buscar-1.php] En el menú de selección del nivel de usuario incluimos como primera opción una opción vacía para indicar que nos da igual el nivel de usuario:
            <div class="codigo">
              <pre>
<code class="language-php">    print "          &lt;tr&gt;\n";
    print "            &lt;td&gt;Nivel:&lt;/td&gt;\n";
    print "            &lt;td&gt;\n";
    print "              &lt;select name=\"nivel\"&gt;\n";
    print "                &lt;option value=\"\"&gt;&lt;/option&gt;\n";
    foreach ($cfg["usuariosNiveles"] as $indice =&gt; $valor) {
        print "                &lt;option value=\"$indice\"&gt;$valor&lt;/option&gt;\n";
    }
    print "              &lt;/select&gt;\n";
    print "            &lt;/td&gt;\n";
    print "          &lt;/tr&gt;\n";</code>
</pre>
            </div>
          </li>
          <li>[buscar-2.php] Para poder hacer una búsqueda con comodines, algunos sistemas gestores de bases de datos (como PostgreSQL) necesitan que el campo sea de tipo texto. Como nivel es de tipo numérico, debemos hacer la conversión (SQLite o MySQL no la necesitan, pero la admiten):
            <div class="codigo">
              <pre>
<code class="language-php">$consulta = "SELECT * FROM $cfg[dbUsuariosTabla]
             WHERE usuario LIKE :usuario
             AND CAST(nivel AS VARCHAR) LIKE :nivel
             ORDER BY $ordena";

$resultado = $pdo-&gt;prepare($consulta);
if (!$resultado) {
    print "    &lt;p class=\"aviso\"&gt;Error al preparar la consulta. SQLSTATE[{$pdo-&gt;errorCode()}]: {$pdo-&gt;errorInfo()[2]}&lt;/p&gt;\n";
} elseif (!$resultado-&gt;execute([":usuario" =&gt; "%$usuario%", ":nivel" =&gt; "%$nivel%"])) {
    ...</code>
</pre>
            </div>
          </li>
        </ul>
      </li>
    </ul>
  </section>

  <footer>
    <p class="ultmod">Última modificación de esta página: 5 de febrero de 2022</p>

    <p class="licencia">
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES"><img src="../../../varios/iconos/icono-cc-by-sa.svg" alt="Licencia Creative Commons" title="Licencia Creative Commons BY-SA" width="120" height="42"></a><br>
      Esta página forma parte del curso <strong><a href="https://www.mclibre.org/consultar/php/">Programación web en PHP</a></strong> por <a href="https://www.mclibre.org/" rel="author">Bartolomé Sintes Marco</a><br>
      que se distribuye bajo una <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES">Licencia Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional (CC BY-SA 4.0)</a>.
    </p>
  </footer>
</body>
</html>
