<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Sesiones (1). Soluciones. Ejercicios (sesiones). PHP. Bartolomé Sintes Marco. www.mclibre.org</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../../varios/php.css" title="mclibre">
  <link rel="icon" href="../../../varios/favicon.svg">
  <link rel="stylesheet" href="../../../varios/prism.css">
  <script src="../../../varios/prism.js"></script>
  <script src="../../../varios/mclibre.js"></script>
</head>

<body>
  <h1>Ejercicios (sesiones) - Sesiones (1) - Soluciones</h1>

  <nav>
    <p>
      <a href="../../../index.html"><img src="../../../varios/iconos/icono-php.svg" alt="Índice de PHP" title="Índice de PHP" width="48" height="48"></a>
      <a href="#"><img src="../../../varios/iconos/icono-arrow-circle-up.svg" alt="Principio de la página" title="Principio de la página" width="36" height="36"></a>
    </p>

    <div class="toc">
      <h2>Sesiones (1)</h2>

      <h3><a href="#">Enunciados</a></h3>
      <ul>
        <li><a href="index.html#ejercicio-1">1 - Mover un punto</a></li>
        <li><a href="index.html#ejercicio-2">2 - Mover un punto 2D</a></li>
        <li><a href="index.html#ejercicio-3">3 - Votar una opción</a></li>
        <li><a href="index.html#ejercicio-4">4 - Hucha de monedas</a></li>
        <li><a href="index.html#ejercicio-5">5 - Cara o cruz</a></li>
        <li><a href="index.html#ejercicio-6">6 - Quita cartas</a></li>
      </ul>

      <h3><a href="soluciones.html">Soluciones</a></h3>
      <ul>
        <li><a href="#ejercicio-1">1 - Mover un punto</a></li>
        <li><a href="#ejercicio-2">2 - Mover un punto 2D</a></li>
        <li><a href="#ejercicio-3">3 - Votar una opción</a></li>
        <li><a href="#ejercicio-4">4 - Hucha de monedas</a></li>
        <li><a href="#ejercicio-5-a">5 - Cara o cruz - A</a></li>
        <li><a href="#ejercicio-5-b">5 - Cara o cruz - B</a></li>
        <li><a href="#ejercicio-6-a">6 - Quita cartas - A</a></li>
        <li><a href="#ejercicio-6-b">6 - Quita cartas - B</a></li>
      </ul>
    </div>
  </nav>

  <p>En esta página se muestran una parte de las soluciones de los ejercicios <a href="index.html">Sesiones (1)</a>.</p>

  <p>Si lo prefiere, puede <a href="../../../soluciones/con-sesiones/cs-sesiones-1-soluciones.zip">descargar unas posibles soluciones completas</a> de estos ejercicios.</p>

  <p><img src="../../../varios/iconos/icono-warning.svg" alt="¡Atención!" title="¡Atención!" width="55" height="48">Para hacer estos ejercicios, se recomienda seguir el recorrido de la aplicación, suponiendo que el usuario introduce datos. Pero una vez completada la aplicación hay que comprobar desde el principio (cerrando el navegador previamente) que la aplicación funciona correctamente (es decir, que la aplicación tiene en cuenta que la primera vez que se ejecuta, todavía no hay datos).</p>

  <section id="ejercicio-1">
    <h3>Sesiones (1) 1 - Mover un punto a derecha e izquierda</h3>

    <p>Este ejercicio es muy similar al anterior: mediante dos botones se aumenta o disminuye un valor. La diferencia es que en este ejercicio el valor no se muestra, pero se utiliza para situar un punto en una línea.</p>

    <ol>
      <li id="li-12-1">Para que las dos páginas del programa puedan utilizar la coordenada del punto (en la página 1 el número se incluye en el dibujo y en la página 2 se modifica), guardaremos el número en $_SESSION. Por tanto, debemos unir la página 1 a una sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
      <li id="li-12-2">Cuando se abre la página 1 por primera vez, $_SESSION no contiene ningún dato e intentar imprimirlo o modificarlo provocaría un error, por lo que damos valor a la variable si no existe.</li>
      <li id="li-12-3">La página 1 coloca el punto rojo en el valor guardado en $_SESSION.</li>
      <li id="li-12-4">Para que la página 2 pueda modificar los datos guardados en $_SESSION, debemos unir la página a la misma sesión que la página 1.</li>
      <li id="li-12-5">Si la variable de sesión no está definida, redirigiremos a la página 1 donde se le dará un valor inicial.</li>
      <li id="li-12-6">La página 2 debe recoger el dato enviado por el formulario de la página 1. En la página 1 hay 2 botones que tienen el mismo <span class="html-atri">name</span>, por lo que sólo hay que recoger un dato.
        <p>Como en cualquier página que recibe un control de un formulario, añadimos la función recoge() y definimos una variable para recoger el dato</p>
      </li>
      <li id="li-12-7">En la página 2 modificamos el valor guardado en la sesión, dependiendo del dato recibido (se aumenta, se reduce o se pone a cero).</li>
      <li id="li-12-8">Para que cuando el punto salga por un lado del dibujo entre por el otro, se debe comprobar si el valor supera los extremos y, en su caso, cambiarlo por el otro valor extremo.</li>
      <li id="li-12-9">Finalmente, la página 2 redirige a la página 1.</li>
    </ol>

    <p>sesiones-1-1-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión <span class="numero-circulo" tooltip-id="li-12-1">1</span>
session_name("sesiones-1-1");
session_start();

// Si la posición no está guardada en la sesión, redirigimos a la primera página <span class="numero-circulo" tooltip-id="li-12-5">5</span>
if (!isset($_SESSION["posicion"])) {
    header("Location:sesiones-1-1-1.php");
    exit;
}
?&gt;
&lt;!DOCTYPE html&gt;
// ...
            &lt;line x1=\"-300\" y1=\"10\" x2=\"300\" y2=\"10\" stroke=\"black\" stroke-width=\"5\" /&gt;
&lt;?php
// Dibujamos el círculo en su posición <span class="numero-circulo" tooltip-id="li-12-3">3</span>
print "            &lt;circle cx=\"$_SESSION[posicion]\" cy=\"10\" r=\"8\" fill=\"red\" /&gt;\n";
?&gt;
          &lt;/svg&gt;
// ...</code>
</pre>
    </div>

    <p>sesiones-1-1-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión <span class="numero-circulo" tooltip-id="li-12-4">4</span>
session_name("sesiones-1-11");
session_start();

// Si la posición no está guardada en la sesión, ponemos el valor a cero <span class="numero-circulo" tooltip-id="li-12-2">2</span>
if (!isset($_SESSION["posicion"])) {
    $_SESSION["posicion"] = 0;
}

// Función de recogida de datos <span class="numero-circulo" tooltip-id="li-12-6">6</span>
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos accion
$accion = recoge("accion");

// Dependiendo de la acción recibida, modificamos el número guardado <span class="numero-circulo" tooltip-id="li-12-7">7</span>
if ($accion == "centro") {
    $_SESSION["posicion"] = 0;
} elseif ($accion == "izquierda") {
    $_SESSION["posicion"] -= 20;
} elseif ($accion == "derecha") {
    $_SESSION["posicion"] += 20;
}

// Si el punto sale por un lado, entra por el otro <span class="numero-circulo" tooltip-id="li-12-8">8</span>
if ($_SESSION["posicion"] &gt; 300) {
    $_SESSION["posicion"] = -300;
} elseif ($_SESSION["posicion"] &lt; -300) {
    $_SESSION["posicion"] = 300;
}

// Volvemos al formulario <span class="numero-circulo" tooltip-id="li-12-9">9</span>
header("Location:sesiones-1-1-1.php");</code>
</pre>
    </div>
  </section>

  <section id="ejercicio-2">
    <h3>Sesiones (1) 2 - Mover un punto en dos dimensiones</h3>

    <p>Este ejercicio es muy similar al anterior. La diferencia es que en este ejercicio se tendrán que guardar dos valores (coordenada X y coordenada Y) para situar el punto en el plano.</p>

    <ol>
      <li id="li-13-1">Para que las dos páginas del programa puedan utilizar las coordenadas del punto (en la página 1 los valores se incluyen en el dibujo y en la página 2 se modifican), guardaremos ambos números en $_SESSION. Por tanto, debemos unir la página 1 a una sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
      <li id="li-13-2">Cuando se abre la página 1 por primera vez, $_SESSION no contiene ningún dato e intentar imprimirlo o modificarlo provocaría un error, por lo que damos valor a las dos variables si no existe alguna de ellas.</li>
      <li id="li-13-3">La página 1 coloca el punto rojo mediante los dos valores guardados en $_SESSION.</li>
      <li id="li-13-4">Para que la página 2 pueda modificar los datos guardados en $_SESSION, debemos unir la página a la misma sesión que la página 1.</li>
      <li id="li-13-5">Si alguna variable de sesión no está definida, redirigiremos a la página 1 donde se le dará un valor inicial.</li>
      <li id="li-13-6">La página 2 debe recoger el dato enviado por el formulario de la página 1. En la página 1 hay 5 botones que tienen el mismo <span class="html-atri">name</span>, por lo que sólo hay que recoger un dato.
        <p>Como en cualquier página que recibe un control de un formulario, añadimos la función recoge() y definimos una variable para recoger el dato</p>
      </li>
      <li id="li-13-7">En la página 2 modificamos el valor o los valores guardados en la sesión, dependiendo del dato recibido (se aumenta uno u otro, se reduce uno u otro o se ponen a cero ambos).</li>
      <li id="li-13-8">Para que cuando el punto salga por un lado del dibujo entre por el otro, se debe comprobar si el valor supera los extremos y, en su caso, cambiarlo por el otro valor extremo.</li>
      <li id="li-13-9">Finalmente, la página 2 redirige a la página 1.</li>.
    </ol>

    <p>sesiones-1-2-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión <span class="numero-circulo" tooltip-id="li-13-1">1</span>
session_name("sesiones-1-2");
session_start();

// Si alguna posición no está guardada en la sesión, ponemos los dos valores a cero <span class="numero-circulo" tooltip-id="li-13-2">2</span>
if (!isset($_SESSION["x"]) || !isset($_SESSION["y"])) {
    $_SESSION["x"] = $_SESSION["y"] = 0;
}
?&gt;
&lt;!DOCTYPE html&gt;
// ...
        &lt;td&gt;
          &lt;svg version="1.1" xmlns="http://www.w3.org/2000/svg"
               width="400" height="400" viewBox="-200 -200 400 400" style="border: black 2px solid"&gt;

&lt;?php
// Dibujamos el círculo en su posición <span class="numero-circulo" tooltip-id="li-13-3">3</span>
print "            &lt;circle cx=\"$_SESSION[x]\" cy=\"$_SESSION[y]\" r=\"8\" fill=\"red\" /&gt;\n";
?&gt;
  &lt;/svg&gt;
  &lt;/td&gt;
// ...</code>
</pre>
    </div>

    <p>sesiones-1-2-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión <span class="numero-circulo" tooltip-id="li-13-4">4</span>
session_name("sesiones-1-2");
session_start();

// Si alguna posición no está guardada en la sesión, redirigimos a la primera página <span class="numero-circulo" tooltip-id="li-13-5">5</span>
if (!isset($_SESSION["x"]) || !isset($_SESSION["y"])) {
    header("Location:sesiones-1-2-1.php");
    exit;
}

// Función de recogida de datos <span class="numero-circulo" tooltip-id="li-13-6">6</span>
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos accion
$accion = recoge("accion");

// Dependiendo de la acción recibida, modificamos el número guardado <span class="numero-circulo" tooltip-id="li-13-7">7</span>
if ($accion == "centro") {
    $_SESSION["x"] = $_SESSION["y"] = 0;
} elseif ($accion == "izquierda") {
    $_SESSION["x"] -= 20;
} elseif ($accion == "derecha") {
    $_SESSION["x"] += 20;
} elseif ($accion == "arriba") {
    $_SESSION["y"] -= 20;
} elseif ($accion == "abajo") {
    $_SESSION["y"] += 20;
}

// Si el punto sale por la izquierda o la derecha, entra por el otro lado <span class="numero-circulo" tooltip-id="li-13-8">8</span>
if ($_SESSION["x"] &gt; 200) {
    $_SESSION["x"] = -200;
} elseif ($_SESSION["x"] &lt; -200) {
    $_SESSION["x"] = 200;
}

// Si el punto sale por arriba o por abajo, entra por el otro lado
if ($_SESSION["y"] &gt; 200) {
    $_SESSION["y"] = -200;
} elseif ($_SESSION["y"] &lt; -200) {
    $_SESSION["y"] = 200;
}

// Volvemos al formulario <span class="numero-circulo" tooltip-id="li-13-9">9</span>
header("Location:sesiones-1-2-1.php");</code>
</pre>
    </div>
  </section>

  <section id="ejercicio-3">
    <h3>Sesiones (1) 3 - Votar una opción</h3>

    <p>Este ejercicio es muy similar al anterior. La diferencia es que cada valor se utiliza en un dibujo distinto.</p>

    <ol>
      <li id="li-14-1">Los datos clave de este programa son las longitudes de las barras de colores. Para que las dos páginas del programa puedan utilizar o modificar estos valores, guardaremos ambos números en $_SESSION. Por tanto, debemos unir la página 1 a una sesión. Conviene dar nombre a la sesión para que cada ejercicio utilice su propia matriz $_SESSION distinta del resto.</li>
      <li id="li-14-2">Cuando se abre la página 1 por primera vez, $_SESSION no contiene ningún dato e intentar imprimirlo o modificarlo provocaría un error, por lo que damos valor a las dos variables si no existe alguna de ellas.</li>
      <li id="li-14-3">La página 1 dibuja la primera barra a partir de uno de los valores guardado en $_SESSION. El valor se utiliza en dos atributos.</li>
      <li id="li-14-4">La página 1 dibuja la segunda barra a partir del otro valor guardado en $_SESSION. El valor se utiliza en dos atributos.</li>
      <li id="li-14-5">Para que la página 2 pueda modificar los datos guardados en $_SESSION, debemos unir la página a la misma sesión que la página 1.</li>
      <li id="li-14-6">Si alguna variable de sesión no está definida, redirigiremos a la página 1 donde se le dará un valor inicial.</li>
      <li id="li-14-7">La página 2 debe recoger el dato enviado por el formulario de la página 1. En la página 1 hay 3 botones que tienen el mismo <span class="html-atri">name</span>, por lo que sólo hay que recoger un dato.
        <p>Como en cualquier página que recibe un control de un formulario, añadimos la función recoge() y definimos una variable para recoger el dato</p>
      </li>
      <li id="li-14-8">En la página 2 modificamos uno o los dos valores, dependiendo del dato recibido (se aumenta uno, se aumenta el otro, o se ponen a cero ambos).</li>
      <li id="li-14-9">Finalmente, la página 2 redirige a la página 1.</li>.
    </ol>

    <p>sesiones-1-3-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión <span class="numero-circulo" tooltip-id="li-14-1">1</span>
session_name("sesiones-1-3");
session_start();

// Si algún contador no está guardado en la sesión, ponemos ambos a cero <span class="numero-circulo" tooltip-id="li-14-2">2</span>
if (!isset($_SESSION["a"]) || !isset($_SESSION["b"])) {
    $_SESSION["a"] =  $_SESSION["b"] = 0;
}
?&gt;
&lt;!DOCTYPE html&gt;
// ...
      &lt;tr&gt;
        &lt;td style="vertical-align: top;"&gt;&lt;button type="submit" name="accion" value="a" style="font-size: 60px; line-height: 50px; color: hwb(200 0% 0%);"&gt;&#x2714;&lt;/button&gt;&lt;/td&gt;
        &lt;td&gt;
&lt;?php
// Dibujamos la primera barra <span class="numero-circulo" tooltip-id="li-14-3">3</span>
print "          &lt;svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"\n";
print "               width=\"$_SESSION[a]\" height=\"50\"&gt;\n";
print "            &lt;line x1=\"0\" y1=\"25\" x2=\"$_SESSION[a]\" y2=\"25\" stroke=\"hwb(200 0% 0%)\" stroke-width=\"50\" /&gt;\n";
print "          &lt;/svg&gt;\n";
?&gt;
      &lt;/td&gt;
      &lt;tr&gt;
        &lt;td&gt;&lt;button type="submit" name="accion" value="b" style="font-size: 60px; line-height: 50px; color: hwb(35 0% 0%)"&gt;&#x2714;&lt;/button&gt;&lt;/td&gt;
        &lt;td&gt;
&lt;?php
// Dibujamos la segunda barra <span class="numero-circulo" tooltip-id="li-14-4">4</span>
print "          &lt;svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"\n";
print "               width=\"$_SESSION[b]\" height=\"50\"&gt;\n";
print "            &lt;line x1=\"0\" y1=\"25\" x2=\"$_SESSION[b]\" y2=\"25\" stroke=\"hwb(35 0% 0%)\" stroke-width=\"50\" /&gt;\n";
print "          &lt;/svg&gt;\n";
?&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
// ...</code>
</pre>
    </div>

    <p>sesiones-1-3-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión <span class="numero-circulo" tooltip-id="li-14-5">5</span>
session_name("sesiones-1-3");
session_start();

// Si alguno de los números de votos no está guardado en la sesión, ponemos ambos a cero <span class="numero-circulo" tooltip-id="li-14-6">6</span>
if (!isset($_SESSION["a"]) || !isset($_SESSION["b"])) {
    $_SESSION["a"] =  $_SESSION["b"] = 0;
}

// Función de recogida de datos <span class="numero-circulo" tooltip-id="li-14-7">7</span>
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos accion
$accion = recoge("accion");

// Dependiendo de la acción recibida, modificamos el número correspondiente <span class="numero-circulo" tooltip-id="li-14-8">8</span>
if ($accion == "a") {
    $_SESSION["a"] += 10;
} elseif ($accion == "b") {
    $_SESSION["b"] += 10;
} elseif ($accion == "cero") {
    $_SESSION["a"] = $_SESSION["b"] = 0;
}

// Volvemos al formulario <span class="numero-circulo" tooltip-id="li-14-9">9</span>
header("Location:sesiones-1-3-1.php");
?&gt;</code>
</pre>
    </div>
  </section>

  <section id="ejercicio-4">
    <h3>Sesiones (2) 4 - Hucha de monedas (ejercicio examen curso 2017/18)</h3>

    <p>sesiones-1-4-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-4-1");
session_start();

// Si el ahorro no está guardado en la sesión, inicializamos el valor a cero
if (!isset($_SESSION["ahorro"])) {
    $_SESSION["ahorro"] = 0;
}

?&gt;
&lt;!DOCTYPE html&gt;
// ...
        &lt;/g&gt;
&lt;?php
// Mostramos la cantidad ahorrada
print "        &lt;text x=\"170\" y=\"110\" font-size=\"60\" text-anchor=\"middle\"&gt;$_SESSION[ahorro]&lt;/text&gt;\n";
?&gt;
// ...</code>
</pre>
    </div>

    <p>sesiones-1-4-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-4-1");
session_start();

// Si el ahorro no está guardado en la sesión, redirigimos a la primera página
if (!isset($_SESSION["ahorro"])) {
    header("Location:sesiones-1-4-1.php");
    exit;
}

// Función de recogida de datos
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos la moneda y la acción
$moneda = recoge("moneda");
$accion = recoge("accion");

if ($accion == "Vaciar hucha") {
    // Si la acción es vaciar la hucha, se vacía
    $_SESSION["ahorro"] = 0;
} elseif (in_array($moneda, [0.01, 0.02, 0.05, 0.10, 0.20, 0.50, 1, 2])) {
    // Si llega una moneda, se añade
    $_SESSION["ahorro"] += $moneda;
}

// Volvemos a la primera página
header("Location:sesiones-1-4-1.php");</code>
</pre>
    </div>
  </section>

  <section id="ejercicio-5-a">
    <h3>Sesiones (2) 5 - Cara o cruz (ejercicio examen curso 2017/18) - Solución A</h3>

    <p>En esta solución se utilizan cinco variables de sesión (el número de rondas ganadas por cada jugador, los dos emojis y la moneda a mostrar). De esta manera, la primera página sólo escribe los valores de las variables de sesión. Toda la "lógica" del programa está en la segunda página.</p>

    <p>sesiones-1-5-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-5");
session_start();

// Si falta una de las tres variables de sesión, reiniciamos los valores
if (!isset($_SESSION["puntosG"], $_SESSION["puntosM"], $_SESSION["moneda"])) {
    $_SESSION["puntosG"] = 0;
    $_SESSION["puntosM"] = 0;
    $_SESSION["moneda"]  = "";
    $_SESSION["caraG"]   = "&amp;#128572;";
    $_SESSION["caraM"]   = "&amp;#128586;";
}

?&gt;
&lt;!DOCTYPE html&gt;
// ..
  &lt;table style="text-align: center;"&gt;
    &lt;tr&gt;
      &lt;th&gt;Jugador A&lt;/th&gt;
      &lt;th&gt;Resultado&lt;/th&gt;
      &lt;th&gt;Jugador B&lt;/th&gt;
    &lt;/tr&gt;
&lt;?php
print "    &lt;tr style=\"font-size: 400%\"&gt;\n";

// Mostramos la puntuación del gato
print "      &lt;td&gt;$_SESSION[puntosG]&lt;/td&gt;\n";

print "      &lt;td&gt;&lt;/td&gt;\n";

// Mostramos la puntuación del mono
print "      &lt;td&gt;$_SESSION[puntosM]&lt;/td&gt;\n";

print "    &lt;/tr&gt;\n";

print "    &lt;tr style=\"font-size: 400%\"&gt;\n";

// Mostramos la cara del gato
print "      &lt;td&gt;$_SESSION[caraG]&lt;/td&gt;\n";

// Mostramos la moneda
print "      &lt;td&gt;$_SESSION[moneda]&lt;/td&gt;\n";

// Mostramos la cara del mono
print "      &lt;td&gt;$_SESSION[caraM]&lt;/td&gt;\n";

print "    &lt;/tr&gt;\n";
?&gt;
// ...</code>
</pre>
    </div>

    <p>sesiones-1-5-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-5");
session_start();

// Si falta una de las tres variables de sesión, redirigimos a la primera página
if (!isset($_SESSION["puntosG"], $_SESSION["puntosM"], $_SESSION["moneda"])) {
    header("Location:sesiones-1-5-1.php");
    exit;
}

// Función de recogida de datos
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos la acción
$siguiente = recoge("siguiente");

if ($siguiente == "Lanzar moneda") {
    // Si la acción es lanzar la moneda ...

    // Lanzamos la moneda
    $moneda = rand(1, 2);

    // Calculamos quién gana la ronda y la imagen de la moneda
    if ($moneda == 1) {
        $_SESSION["puntosG"] += 1;
        $_SESSION["moneda"] = "&lt;img src=\"img/a.svg\" alt=\"A\" width=\"100\" height=\"100\"&gt;";
    } else {
        $_SESSION["puntosM"] += 1;
        $_SESSION["moneda"] = "&lt;img src=\"img/b.svg\" alt=\"B\" width=\"100\" height=\"100\"&gt;";
    }

    // Calculamos la cara del gato y del mono
    if ($_SESSION["puntosG"] &gt; $_SESSION["puntosM"]) {
        $_SESSION["caraG"] = "&amp;#128568;";
        $_SESSION["caraM"] = "&amp;#128584;";
    } elseif ($_SESSION["puntosG"] &lt; $_SESSION["puntosM"]) {
        $_SESSION["caraG"] = "&amp;#128576;";
        $_SESSION["caraM"] = "&amp;#128053;";
    } else {
        $_SESSION["caraG"] = "&amp;#128572;";
        $_SESSION["caraM"] = "&amp;#128586;";
    }
} elseif ($siguiente == "Volver a empezar") {
    // Si la acción es volver a empezar, destruimos la sesión
    session_destroy();
}

// Volvemos a la primera página
header("Location:sesiones-1-5-1.php");</code>
</pre>
    </div>
  </section>

  <section id="ejercicio-5-b">
    <h3>Sesiones (2) 5 - Cara o cruz (ejercicio examen curso 2017/18) - Solución B</h3>

    <p>En esta solución se utilizan únicamente tres variables de sesión (el número de rondas ganadas por cada jugador y quién ha ganado la ronda). Eso obliga a que en la primera página se tenga que decidir los emojis y la imagen de la moneda a mostrar.</p>

    <p>sesiones-1-5-b-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-5-b");
session_start();

// Si falta una de las tres variables de sesión, reiniciamos los valores
if (!isset($_SESSION["g"], $_SESSION["m"], $_SESSION["moneda"])) {
    $_SESSION["moneda"] = 0;
    $_SESSION["g"]      = 0;
    $_SESSION["m"]      = 0;
}

?&gt;
&lt;!DOCTYPE html&gt;
// ...
  &lt;table style="text-align: center;"&gt;
    &lt;tr&gt;
      &lt;th&gt;Jugador A&lt;/th&gt;
      &lt;th&gt;Resultado&lt;/th&gt;
      &lt;th&gt;Jugador B&lt;/th&gt;
    &lt;/tr&gt;
&lt;?php
// Mostramos las puntuaciones de cada jugador
print "    &lt;tr style=\"font-size: 400%\"&gt;\n";
print "      &lt;td&gt;$_SESSION[g]&lt;/td&gt;\n";
print "      &lt;td&gt;&lt;/td&gt;\n";
print "      &lt;td&gt;$_SESSION[m]&lt;/td&gt;\n";
print "    &lt;/tr&gt;\n";

// Calculamos la cara del gato
print "    &lt;tr style=\"font-size: 400%\"&gt;\n";
if ($_SESSION["g"] &gt; $_SESSION["m"]) {
    print "      &lt;td&gt;&amp;#128568;&lt;/td&gt;\n";
} elseif ($_SESSION["g"] &lt; $_SESSION["m"]) {
    print "      &lt;td&gt;&amp;#128576;&lt;/td&gt;\n";
} else {
    print "      &lt;td&gt;&amp;#128572;&lt;/td&gt;\n";
}

// Enseñamos la moneda
if ($_SESSION["moneda"] == 0) {
    print "      &lt;td&gt;&lt;/td&gt;\n";
} elseif ($_SESSION["moneda"] == 1) {
    print "      &lt;td&gt;&lt;img src=\"img/a.svg\" alt=\"A\" width=\"100\" height=\"100\"&gt;&lt;/td&gt;\n";
} else {
    print "      &lt;td&gt;&lt;img src=\"img/b.svg\" alt=\"B\" width=\"100\" height=\"100\"&gt;&lt;/td&gt;\n";
}

// Calculamos la cara del mono
if ($_SESSION["g"] &gt; $_SESSION["m"]) {
    print "      &lt;td&gt;&amp;#128584;&lt;/td&gt;\n";
} elseif ($_SESSION["g"] &lt; $_SESSION["m"]) {
    print "      &lt;td&gt;&amp;#128053;&lt;/td&gt;\n";
} else {
    print "      &lt;td&gt;&amp;#128586;&lt;/td&gt;\n";
}
print "    &lt;/tr&gt;\n";
?&gt;</code>
</pre>
    </div>

    <p>sesiones-1-5-b-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-5-b");
session_start();

// Si falta una de las tres variables de sesión, redirigimos a la primera página
if (!isset($_SESSION["g"], $_SESSION["m"], $_SESSION["moneda"])) {
    header("Location:sesiones-1-5-b-1.php");
    exit;
}

// Función de recogida de datos
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos la acción
$siguiente = recoge("siguiente");

if ($siguiente == "Lanzar moneda") {
    // Si la acción es lanzar la moneda ...
    // Lanzamos la moneda
    $_SESSION["moneda"] = rand(1, 2);
    // Calculamos quién gana la ronda
    if ($_SESSION["moneda"] == 1) {
        $_SESSION["g"] += 1;
    } else {
        $_SESSION["m"] += 1;
    }
} elseif ($siguiente == "Volver a empezar") {
    // Si la acción es volver a empezar, reiniciamos las variables de sesión
    $_SESSION["moneda"] = 0;
    $_SESSION["g"]      = 0;
    $_SESSION["m"]      = 0;
}

// Volvemos a la primera página
header("Location:sesiones-1-5-b-1.php");</code>
</pre>
    </div>
  </section>

  <section id="ejercicio-6-a">
    <h3>Sesiones (2) 6 - Quita cartas (ejercicio examen curso 2017/18) - Solución A</h3>

    <p>En esta solución se utilizan dos variables de sesión (el número de cartas a mostrar y el mensaje a mostrar). De esta manera, la primera página sólo escribe los valores de las variables de sesión. Toda la "lógica" del programa está en la segunda página.</p>

    <p>sesiones-1-6-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-6");
session_start();

// Si falta una de las dos variables de sesión, reiniciamos los valores
if (!isset($_SESSION["cartas"], $_SESSION["mensaje"])) {
    $_SESSION["cartas"]  = rand(3, 10);
    $_SESSION["mensaje"] = "  &lt;p&gt;Quedan $_SESSION[cartas] cartas. Haga clic en el dibujo para eliminar una carta.&lt;/p&gt;\n";
}

?&gt;
&lt;!DOCTYPE html&gt;
// ...

&lt;body&gt;
  &lt;h1&gt;Quita cartas&lt;/h1&gt;

&lt;?php
// Escribimos el mensaje
print $_SESSION["mensaje"];
print "\n";
?&gt;
  &lt;form action="sesiones-1-6-2.php"&gt;
    &lt;p&gt;
      &lt;button type="submit" name="quita" value="quita" style="background-color: #eee;"&gt;
        &lt;svg version="1.1" xmlns="http://www.w3.org/2000/svg"
             width="210" height="250" viewBox="-10 -10 210 250"&gt;
          &lt;defs&gt;
            &lt;pattern id="patron-1" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse" &gt;
              &lt;rect x="0" y="0" width="10" height="10" fill="hwb(0 60% 0%)" /&gt;
              &lt;line x1="0" y1="10" x2="10" y2="0" stroke="hwb(0 80% 0%)" stroke-width="1" /&gt;
              &lt;line x1="0" y1="0" x2="10" y2="10" stroke="hwb(0 80% 0%)" stroke-width="1" /&gt;
            &lt;/pattern&gt;
          &lt;/defs&gt;

&lt;?php
// Hacemos un bucle para dibujar el número de cartas guardado en la sesión
for ($i = 0; $i &lt; $_SESSION["cartas"]; $i++) {
    $pos = 10 * $i;
    print "          &lt;rect x=\"$pos\" y=\"$pos\" width=\"100\" height=\"140\" rx=\"5\" ry=\"5\" style=\"stroke: black; fill: url(#patron-1);\" /&gt;\n";
}
?&gt;
// ...</code>
</pre>
    </div>

    <p>sesiones-1-6-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-6");
session_start();

// Si falta una de las dos variables de sesión, redirigimos a la primera página
if (!isset($_SESSION["cartas"], $_SESSION["mensaje"])) {
    header("Location:sesiones-1-6-1.php");
    exit;
}

// Función de recogida de datos
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos la orden de quitar una carta
$quita = recoge("quita");

// Si hemos recibido la orden de quitar una carta ...
if ($quita == "quita") {
    // reducimos el número de cartas a mostrar guardado
    $_SESSION["cartas"] -= 1;
    // Si el número de cartas a mostrar guardado era cero y al reducirlo se hace negativo ...
    if ($_SESSION["cartas"] &lt; 0) {
        // lo generamos al azar
        $_SESSION["cartas"] = rand(3, 10);
    }
    // Guardamos el mensaje correspondiente al número de cartas
    if ($_SESSION["cartas"] == 0) {
        $_SESSION["mensaje"] = "  &lt;p&gt;No quedan cartas. Haga clic en el dibujo para volver a poner cartas.&lt;/p&gt;\n";
    } elseif ($_SESSION["cartas"] == 1) {
        $_SESSION["mensaje"] = "  &lt;p&gt;Queda $_SESSION[cartas] sola carta. Haga clic en el dibujo para eliminarla.&lt;/p&gt;\n";
    } else {
        $_SESSION["mensaje"] = "  &lt;p&gt;Quedan $_SESSION[cartas] cartas. Haga clic en el dibujo para eliminar una carta.&lt;/p&gt;\n";
    }
}

// Volvemos a la primera página
header("Location:sesiones-1-6-1.php");</code>
</pre>
    </div>
  </section>

  <section id="ejercicio-6-b">
    <h3>Sesiones (2) 6 - Quita cartas (ejercicio examen curso 2017/18) - Solución B</h3>

    <p>En esta solución se utiliza únicamente una variable de sesión (el número de cartas a mostrar). Eso obliga a que en la primera página se tenga que decidir el mensaje a mostrar.</p>

    <p>sesiones-1-6-b-1.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-6-b");
session_start();

// Si el número de cartas no está guardado en la sesión, lo generamos al azar
if (!isset($_SESSION["cartas"])) {
    $_SESSION["cartas"] = rand(3, 10);
}
?&gt;
&lt;!DOCTYPE html&gt;
// ...

&lt;body&gt;
  &lt;h1&gt;Quita cartas&lt;/h1&gt;

&lt;?php
if ($_SESSION["cartas"] == 0) {
    // Si no quedan cartas, lo dice
    print "  &lt;p&gt;No quedan cartas. Haga clic en el dibujo para volver a poner cartas.&lt;/p&gt;\n";
    print "\n";
} elseif ($_SESSION["cartas"] == 1) {
    // Si no queda una sola carta, lo dice
    print "  &lt;p&gt;Queda $_SESSION[cartas] sola carta. Haga clic en el dibujo para eliminarla.&lt;/p&gt;\n";
    print "\n";
} else {
    // Si quedan varias cartas, lo dice
    print "  &lt;p&gt;Quedan $_SESSION[cartas] cartas. Haga clic en el dibujo para eliminar una carta.&lt;/p&gt;\n";
    print "\n";
}
?&gt;
  &lt;form action="sesiones-1-6-b-2.php"&gt;
    &lt;p&gt;
      &lt;button type="submit" name="quita" value="quita" style="background-color: #eee;"&gt;
        &lt;svg version="1.1" xmlns="http://www.w3.org/2000/svg"
             width="210" height="250" viewBox="-10 -10 210 250"&gt;
          &lt;defs&gt;
            &lt;pattern id="patron-1" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse" &gt;
              &lt;rect x="0" y="0" width="10" height="10" fill="hwb(0 60% 0%)" /&gt;
              &lt;line x1="0" y1="10" x2="10" y2="0" stroke="hwb(0 80% 0%)" stroke-width="1" /&gt;
              &lt;line x1="0" y1="0" x2="10" y2="10" stroke="hwb(0 80% 0%)" stroke-width="1" /&gt;
            &lt;/pattern&gt;
          &lt;/defs&gt;
&lt;?php
for ($i = 0; $i &lt; $_SESSION["cartas"]; $i++) {
    $pos = 10 * $i;
    print "          &lt;rect x=\"$pos\" y=\"$pos\" width=\"100\" height=\"140\" rx=\"5\" ry=\"5\" style=\"stroke: black; fill: url(#patron-1);\" /&gt;\n";
}
?&gt;
// ...</code>
</pre>
    </div>

    <p>sesiones-1-6-b-2.php</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
// Accedemos a la sesión
session_name("sesiones-1-6-b");
session_start();

// Si el número de cartas no está guardado en la sesión, redirigimos a la primera página
if (!isset($_SESSION["cartas"])) {
    header("Location:sesiones-1-6-1.php");
    exit;
}

// Función de recogida de datos
function recoge($key, $type = "")
{
    if (!is_string($key) && !is_int($key) || $key == "") {
        trigger_error("Function recoge(): Argument #1 (\$key) must be a non-empty string or an integer", E_USER_ERROR);
    } elseif ($type !== "" && $type !== []) {
        trigger_error("Function recoge(): Argument #2 (\$type) is optional, but if provided, it must be an empty array or an empty string", E_USER_ERROR);
    }
    $tmp = $type;
    if (isset($_REQUEST[$key])) {
        if (!is_array($_REQUEST[$key]) && !is_array($type)) {
            $tmp = trim(htmlspecialchars($_REQUEST[$key]));
        } elseif (is_array($_REQUEST[$key]) && is_array($type)) {
            $tmp = $_REQUEST[$key];
            array_walk_recursive($tmp, function (&$value) {
                $value = trim(htmlspecialchars($value));
            });
        }
    }
    return $tmp;
}

// Recogemos la orden de quitar una carta
$quita = recoge("quita");

// Si hemos recibido la orden de quitar una carta ...
if ($quita == "quita") {
    // reducimos el número de cartas a mostrar guardado
    $_SESSION["cartas"] -= 1;
    // Si el número de cartas a mostrar guardado era cero y al reducirlo se hace negativo ...
    if ($_SESSION["cartas"] &lt; 0) {
        // lo generamos al azar
        $_SESSION["cartas"] = rand(3, 10);
    }
}

// Volvemos a la primera página
header("Location:sesiones-1-6-b-1.php");</code>
</pre>
    </div>
  </section>

  <footer>
    <p class="ultmod">Última modificación de esta página: 27 de enero de 2026</p>

    <p class="licencia">
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es"><img src="../../../varios/iconos/icono-cc-by-sa.svg" alt="Licencia Creative Commons" title="Licencia Creative Commons BY-SA" width="120" height="42"></a><br>
      Esta página forma parte del curso <strong><a href="https://www.mclibre.org/consultar/php/">Programación web en PHP</a></strong> por <a href="https://www.mclibre.org/" rel="author">Bartolomé Sintes Marco</a><br>
      que se distribuye bajo una <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es">Licencia Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional (CC BY-SA 4.0)</a>.
    </p>
  </footer>
</body>
</html>
