<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Cabeceras. PHP. Bartolomé Sintes Marco. www.mclibre.org</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../varios/php.css" title="mclibre">
  <link rel="icon" href="../varios/favicon.svg">
  <link rel="stylesheet" href="../varios/prism.css">
  <script src="../varios/prism.js"></script>
</head>

<body>
  <h1>Cabeceras: la función header()</h1>

  <nav>
    <p>
      <a href="../index.html"><img src="../varios/iconos/icono-php.svg" alt="Índice de PHP" title="Índice de PHP" width="48" height="48"></a>
      <a href="#"><img src="../varios/iconos/icono-arrow-circle-up.svg" alt="Principio de la página" title="Principio de la página" width="36" height="36"></a>
    </p>

    <div class="toc">
      <h2>Cabeceras: header()</h2>

      <ul>
        <li><a href="#funcion-header">La función header()</a>
          <ul>
            <li><a href="#buffer">Buffer de salida</a></li>
            <li><a href="#bom">BOM de UTF-8</a></li>
          </ul>
        </li>
        <li><a href="#redirecciones">Redirecciones</a>
          <ul>
            <li><a href="#resto">tras la redirección</a></li>
          </ul>
        </li>
        <li><a href="#otros-tipos">Crear otros tipos de archivos</a>
          <ul>
            <li><a href="#mime-css">Hoja de estilo CSS</a></li>
            <li><a href="#mime-svg">Imagen SVG</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  <p>Puede <a href="../soluciones/2122/cs-ejemplos-plantillas.zip">descargar los ejemplos de esta página</a> para probarlos en su ordenador.</p>

  <section id="funcion-header">
    <h2>La función header()</h2>

    <p>Como se explica en la <a href="php-http.html">lección sobre el protocolo HTTP</a>, cuando un servidor envía una página web al navegador, no sólo envía la página web, sino también información adicional (el estado y los campos de cabecera). Tanto el estado como los campos de cabecera se envían antes de la página web.</p>

    <p>Normalmente, un programa PHP sólo genera la página web y es el servidor el que genera automáticamente la información de estado y los campos de cabecera y los envía antes de enviar el contenido generado por el programa. Pero un programa PHP también puede generar la información de estado y los campos de cabecera, mediante la función <a href="https://www.php.net/manual/en/function.header.php"><span class="php-fun">header()</span></a>.</p>

    <hr class="corta">

    <p>El ejemplo siguiente muestra un ejemplo de cabecera HTTP, concretamente una redirección. En el ejemplo siguiente, la página 1 contiene un enlace a la página 2. Pero como la página genera una cabecera HTTP de redirección a la página 3, al hacer clic en el enlace se muestra la página 3.</p>

    <div class="filaflex">
      <div class="columnaflex">
        <div class="codigo">
          <pre>
<code class="language-html">&lt;p&gt;Esta es la página 1.&lt;/p&gt;

&lt;p&gt;&lt;a href="cabeceras-header-1-2.php"&gt;Enlace a la página 2 (que redirige a la página 3)&lt;/a&gt;&lt;/p&gt;</code>
</pre>
        </div>
        <div class="codigo">
          <pre>
<code class="language-php">&lt;?php
header("Location:cabeceras-header-1-3.php");

print "&lt;p&gt;Esta es la página 2&lt;/p&gt;";

print "&lt;p&gt;La redirección &lt;strong&gt;NO&lt;/strong&gt; se ha realizado&lt;/p&gt;";

print "&lt;p&gt;&lt;a href=\"cabeceras-header-1-1.php\"&gt;Volver a la página 1&lt;/a&gt;&lt;/p&gt;";
?&gt;</code>
</pre>
        </div>
        <div class="codigo">
          <pre>
<code class="language-html">&lt;p&gt;Esta es la página 3.&lt;/p&gt;

&lt;p&gt;La redirección &lt;strong&gt;SÍ&lt;/strong&gt; se ha realizado.&lt;/p&gt;

&lt;p&gt;&lt;a href="cabeceras-header-1-1.php"&gt;Volver a la página 1&lt;/a&gt;&lt;/p&gt;</code>
</pre>
        </div>
      </div>
      <div class="resultado-object">
        <object type="text/html" data="ejemplos/cabeceras/cabeceras-header-1-1.php" style="height: 13em">ERROR (no puede mostrarse el objeto)</object>
      </div>
      <div class="icono-enlace">
        <a href="ejemplos/cabeceras/cabeceras-header-1-1.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
      </div>
    </div>

    <hr class="corta">

    <p>Es muy importante tener en cuenta que la función <span class="php-fun">header()</span> no debe utilizarse una vez se ha generado contenido HTML (por ejemplo, con un <span class="php-res">print</span>). El motivo es que en cuanto un programa genera contenido HTML, el servidor genera automáticamente la información de estado y los campos de cabecera y a continuación envía el contenido generado. Si después el programa contiene una instrucción <span class="php-fun">header()</span>, se produce un error porque las cabeceras ya se han enviado, como muestran los dos ejemplos siguientes.</p>

    <p>En el ejemplo siguiente, se llama a la función <span class="php-fun">header()</span> después de un <span class="php-fun">print</span>, lo que provoca un aviso de error.</p>

    <div class="filaflex">
      <div class="icono-ok">
        <img src="../varios/iconos/icono-okno.svg" alt="Incorrecto" title="Incorrecto" width="40" height="40">
      </div>
      <div class="codigo">
        <pre>
<code class="language-php">&lt;?php
<span class="codigo-resaltado">print "&lt;p&gt;Intento fallido de redirección&lt;/p&gt;\n";</span>
header("Location:http://www.example.com");
?&gt;</code>
</pre>
      </div>
      <div class="resultado-html">
        <p>Intento fallido de redirección</p>

        <p><strong>Warning</strong>: Cannot modify header information - headers already sent by (output started at ejemplo.php:2) in <strong>ejemplo.php</strong> on line 3</p>
      </div>
      <!--
      <div class="resultado-object">
        <object type="text/html" data="https://www.mclibre.org/consultar/especiales/php/header-location-incorrecto/cabeceras-header-incorrecto-1.php" style="height: 10em">ERROR (no puede mostrarse el objeto)</object>
      </div>
      <div class="icono-enlace">
        <a href="https://www.mclibre.org/consultar/especiales/php/header-location-incorrecto/cabeceras-header-incorrecto-1.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
      </div>
      -->
    </div>

    <p>En el ejemplo siguiente, se llama a la función <span class="php-fun">header()</span> en un programa que ya ha generado contenido antes del fragmento PHP, lo que provoca un aviso de error:</p>

    <div class="filaflex">
      <div class="icono-ok">
        <img src="../varios/iconos/icono-okno.svg" alt="Incorrecto" title="Incorrecto" width="40" height="40">
      </div>
      <div class="codigo">
        <pre><span class="codigo-resaltado"><code class="language-html">&lt;p&gt;Intento fallido de redirección&lt;/p&gt;</code></span></pre>
        <pre>
<code class="language-php">&lt;?php
header("Location:http://www.example.com");
?&gt;</code>
</pre>
      </div>
      <div class="resultado-html">
        <p>Intento fallido de redirección</p>

        <p><strong>Warning</strong>: Cannot modify header information - headers already sent by (output started at ejemplo.php:2) in <strong>ejemplo.php</strong> on line 3</p>
      </div>
      <!--
      <div class="resultado-object">
        <object type="text/html" data="https://www.mclibre.org/consultar/especiales/php/header-location-incorrecto/cabeceras-header-incorrecto-2.php" style="height: 10em">ERROR (no puede mostrarse el objeto)</object>
      </div>
      <div class="icono-enlace">
        <a href="https://www.mclibre.org/consultar/especiales/php/header-location-incorrecto/cabeceras-header-incorrecto-2.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
      </div>
      -->
    </div>

    <p>Por ello hay que tener mucho cuidado en no generar nada de texto antes de utilizar la función <span class="php-fun">header()</span>, ni en el programa ni en las bibliotecas a las que se llame en el programa.</p>

    <p>Hay que tener en cuenta que una simple línea en blanco antes del bloque PHP sería suficiente para impedir el envío de la cabecera:</p>

    <div class="filaflex">
      <div class="icono-ok">
        <img src="../varios/iconos/icono-okno.svg" alt="Incorrecto" title="Incorrecto" width="40" height="40">
      </div>
      <div class="codigo">
        <pre>
<code class="language-php"><span class="codigo-resaltado"></span>
&lt;?php
header("Location:http://www.example.com");
?&gt;</code>
</pre>
      </div>
      <div class="resultado-html">
        <p><strong>Warning</strong>: Cannot modify header information - headers already sent by (output started at ejemplo.php:2) in <strong>ejemplo.php</strong> on line 3</p>
      </div>
      <!--
      <div class="resultado-object">
        <object type="text/html" data="https://www.mclibre.org/consultar/especiales/php/header-location-incorrecto/cabeceras-header-incorrecto-3.php" style="height: 8em">ERROR (no puede mostrarse el objeto)</object>
      </div>
      <div class="icono-enlace">
        <a href="https://www.mclibre.org/consultar/especiales/php/header-location-incorrecto/cabeceras-header-incorrecto-3.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
      </div>
    -->
    </div>

    <p><strong>Nota</strong>: Otra situación que puede provocar el fallo de la función <span class="php-fun">header()</span> es cuando el programa contiene un error antes de la función <span class="php-fun">header()</span>, ya que PHP generará un aviso de error que es también parte de la salida del programa y eso provocaría el fallo de la función <span class="php-fun">header()</span> posterior. Esta situación suele darse al desarrollar el programa, ya que normalmente los servidores de desarrollo están configurados para mostrar el mayor número posible de avisos de error, pero es menos probable en los servidores de producción, que se suelen configurar para no enviar al usuario ningún mensaje de error.</p>

    <section id="buffer">
      <h3>Cabeceras y buffer de salida</h3>

      <p>El buffer de salida del intérprete PHP se crea mediante la <a href="../otros/php-configuracion-1.html#output-buffering">directiva <span class="php-dir">output_buffering</span></a>. El buffer de salida almacena temporalmente la salida del programa, que no se envía al navegador hasta que se complete la página o se llene el buffer.</p>

      <p>Si el servidor está utilizando un buffer de salida (lo que es muy habitual), el error de utilizar la función <span class="php-fun">header()</span> después de crear contenido HTML que se ha comentado en el apartado anterior puede no llegar a producirse.</p>

      <p>Si cuando el programa llega a la instrucción <span class="php-fun">header()</span>, el contenido HTML generado anteriormente ha cabido en el buffer de salida y todavía no se ha enviado al navegador, el servidor puede todavía modificar la información de cabecera y la función <span class="php-fun">header()</span> no daría error. Pero si el contenido HTML hubiera sido mayor que el tamaño del buffer, el error sí que se produciría porque las cabeceras ya se habrían enviado.</p>

      <p>El uso de un buffer de salida puede así enmascarar en ciertos casos errores de programación como los de los ejemplos anteriores. Por ese motivos, en la <a href="../otros/php-configuracion-1.html#output-buffering">lección de configuración de XAMPP</a> se recomienda desactivar el buffer de salida al desarrollar el programa, de manera que al probar el programa detectemos este tipo de errores.</p>

      <hr class="corta">

      <p>Los ejemplos siguientes muestran la influencia del tamaño del buffer. En estos ejemplos se utilizan las funciones <a href="https://www.php.net/manual/en/function.ob-start.php"><span class="php-fun">ob_start()</span></a> y <a href="https://www.php.net/manual/en/function.ob-end-flush.php"><span class="php-fun">ob_end_flush()</span></a>, que permiten gestionar directamente el buffer de salida independientemente de la configuración del servidor. Estos buffers son temporales y desaparecen cuando se termina de ejecutar la página.</p>

      <ul>
        <li>En el ejemplo siguiente, el buffer es de 1 byte. El contenido HTML generado por la instrucción <span class="php-res">print</span> no cabe en el buffer y la redirección no llega a realizarse, por lo que el usuario ve el contenido de la página 2.

          <div class="filaflex">
            <div class="columnaflex">
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 1.&lt;/p&gt;

&lt;p&gt;&lt;a href="buffer-falta-2.php"&gt;Enlace a la página 2 (que redirige a la página 3)&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-php">&lt;?php
<span class="codigo-resaltado">ob_start(null, 1);</span>

print "&lt;p&gt;Esta es la página 2.&lt;/p&gt;\n";
print "&lt;p&gt;Tamaño del buffer: 1&lt;/p&gt;";

header("Location:buffer-falta-3.php");

print "&lt;p&gt;La redirección &lt;strong&gt;NO&lt;/strong&gt; se ha realizado.&lt;/p&gt;\n";
print "&lt;p&gt;&lt;a href=\"buffer-falta-1.php\"&gt;Volver al principio&lt;/a&gt;&lt;/p&gt;\n";
?&gt;</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 3.&lt;/p&gt;
&lt;p&gt;La redirección se ha realizado.&lt;/p&gt;

&lt;p&gt;&lt;a href="buffer-falta-1.php"&gt;Volver al principio&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
            </div>
            <div class="resultado-object">
              <object type="text/html" data="https://www.mclibre.org/consultar/especiales/php/buffer-salida/buffer-falta-1.php" style="height: 15em">ERROR (no puede mostrarse el objeto)</object>
            </div>
            <div class="icono-enlace">
              <a href="https://www.mclibre.org/consultar/especiales/php/buffer-salida/buffer-falta-1.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
            </div>
          </div>
        </li>
        <li>En el ejemplo siguiente, el buffer es de 200 bytes. El contenido HTML generado por las instrucciones <span class="php-res">print</span> sí cabe en el buffer y la redirección puede realizarse, por lo que el usuario no llega a ver la página 2.

          <div class="filaflex">
            <div class="columnaflex">
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 1.&lt;/p&gt;

&lt;p&gt;&lt;a href="buffer-sobra-2.php"&gt;Enlace a la página 2 (que redirige a la página 3)&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-php">&lt;?php
<span class="codigo-resaltado">ob_start(null, 200);</span>

print "&lt;p&gt;Esta es la página 2.&lt;/p&gt;\n";
print "&lt;p&gt;Tamaño del buffer: 200&lt;/p&gt;";

header("Location:buffer-sobra-3.php");

print "&lt;p&gt;La redirección &lt;strong&gt;NO&lt;/strong&gt; se ha realizado.&lt;/p&gt;\n";
print "&lt;p&gt;&lt;a href=\"buffer-sobra-1.php\"&gt;Volver al principio&lt;/a&gt;&lt;/p&gt;\n";
?&gt;</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 3.&lt;/p&gt;
&lt;p&gt;La redirección se ha realizado.&lt;/p&gt;

&lt;p&gt;&lt;a href="buffer-sobra-1.php"&gt;Volver al principio&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
            </div>
            <div class="resultado-object">
              <object type="text/html" data="https://www.mclibre.org/consultar/especiales/php/buffer-salida/buffer-sobra-1.php" style="height: 8em">ERROR (no puede mostrarse el objeto)</object>
            </div>
            <div class="icono-enlace">
              <a href="https://www.mclibre.org/consultar/especiales/php/buffer-salida/buffer-sobra-1.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
            </div>
          </div>
        </li>
      </ul>
    </section>

    <section id="bom">
      <h3>Cabeceras y marca de orden de bytes (BOM) de UTF-8</h3>

      <p>Otra situación que puede causar problemas en los programas que incluyen la función <span class="php-fun">header()</span> es la <a href="https://es.wikipedia.org/wiki/Marca_de_orden_de_bytes_%28BOM%29">marca de orden de bytes</a> (BOM) de los archivos UTF-8. Como en el caso anterior, la utilización de un buffer de salida puede enmascarar este problema.</p>

      <p>La marca de orden de bytes son los primeros caracteres de un fichero UTF. Estos caracteres indican:</p>
      <ul>
        <li>el orden de los bytes en los formatos de 16 o 32 bytes. Cuando la codificación de un carácter ocupa más de un byte, los bytes que lo forman pueden estar en el orden natural de lectura (big endian) o en el contrario (little endian). Por ejemplo el carácter A, cuyo código es 0041, se puede guardar en UTF-16 como 00 41 (big endian) o como 41 00 (little endian).</li>
        <li>el formato del archivo en general. Para saber si un archivo está en formato UTF-8, 16 o 32 (es decir, si cada byte del archivo es un carácter, o los bytes se tienen que tomar de dos en dos, o de cuatro en cuatro), los programas sólo tienen que mirar los primeros bytes del archivo y a partir del BOM deducir el formato.</li>
      </ul>

      <p>En el caso de los archivos UTF-8 realmente no se necesita marca de orden de bytes porque el orden de los bytes debe ser siempre el orden natural, pero el caso es que existe una marca de orden de bytes, los tres caracteres EF BB BF (que en ASCII corresponden a los caracteres <strong>ï»¿</strong>). En el caso de UTF-8 la marca de orden de bytes es opcional y puede servir para identificar un archivo como UTF-8 y distinguirlo de otros formatos.</p>

      <p>Los editores (como Visual Studio Code) no muestran la marca de orden de bytes y suelen respetarlos al guardar de nuevo al archivo. Para ver esos caracteres, se puede utilizar un editor hexadecimal, que muestra todos los caracteres sin excepción.</p>

      <p>Las imágenes siguientes muestran los valores hexadecimales de dos archivos UTF-8 (sin BOM y con BOM ), utilizando el editor Notepad++ con el plug-in HEX-Editor:</p>

      <p class="captura">
        <img src="../img/php/utf8-bom-sin.png" alt="archivo UTF-8 con BOM" width="1024" height="290">
      </p>

      <p class="captura">
        <img src="../img/php/utf8-bom-con.png" alt="archivo UTF-8 sin BOM" width="1024" height="290">
      </p>

      <p>Esta marca de orden de bytes puede causar problemas si PHP no reconoce la marca de orden de bytes como un identificador de juego de caracteres, sino como caracteres situados antes de un fragmento PHP que se deben enviar al navegador. El comportamiento de PHP depende de las opciones elegidas al compilar el intérprete de PHP, por lo que la única solución viable es asegurarse de que los archivos no tienen BOM (como recomiendan las <a href="../otros/guia-estilo.html">guías de estilo</a> más populares).</p>

      <hr class="corta">

      <p>Los ejemplos siguientes muestran la influencia del BOM cuando no hay buffer de salida.</p>

      <ul>
        <li>En el primer ejemplo, el fichero está guardado en UTF-8 <strong>con</strong> BOM. Al intentar hacer la redirección en la página 2, se produce un error porque la marca de orden de bytes se ha interpretado como contenido de la página.

          <div class="filaflex">
            <div class="columnaflex">
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 1.&lt;/p&gt;

&lt;p&gt;&lt;a href="bom-test-con-bom-2.php"&gt;Enlace a la página 2 (que redirige a la página 3)&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-php">&lt;?php
header("Location:bom-test-con-bom-3.php");

print "&lt;p&gt;Esta es la página 2.&lt;/p&gt;";
print "&lt;p&gt;La redirección &lt;strong&gt;NO&lt;/strong&gt; se ha realizado.&lt;/p&gt;\n";
print "&lt;p&gt;&lt;a href=\"bom-test-con-bom-1.php\"&gt;Volver al principio&lt;/a&gt;&lt;/p&gt;\n";
?&gt;</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 3.&lt;/p&gt;

&lt;p&gt;&lt;a href="bom-test-con-bom-1.php"&gt;Volver a la página 1&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
            </div>
            <div class="resultado-object">
              <object type="text/html" data="https://www.mclibre.org/consultar/especiales/php/bom-test/bom-test-con-bom-1.php" style="height: 13em">ERROR (no puede mostrarse el objeto)</object>
            </div>
            <div class="icono-enlace">
              <a href="https://www.mclibre.org/consultar/especiales/php/bom-test/bom-test-con-bom-1.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
            </div>
          </div>
        </li>
        <li>En el segundo ejemplo, el fichero está guardado en UTF-8 <strong>sin</strong> BOM. La redirección en la página 2 se realiza y se llega a la página 3.

          <div class="filaflex">
            <div class="columnaflex">
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 1.&lt;/p&gt;

&lt;p&gt;&lt;a href="bom-test-sin-bom-2.php"&gt;Enlace a la página 2 (que redirige a la página 3)&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-php">&lt;?php
header("Location:bom-test-sin-bom-3.php");

print "&lt;p&gt;Esta es la página 2.&lt;/p&gt;";
print "&lt;p&gt;La redirección &lt;strong&gt;NO&lt;/strong&gt; se ha realizado.&lt;/p&gt;\n";
print "&lt;p&gt;&lt;a href=\"bom-test-sin-bom-1.php\"&gt;Volver al principio&lt;/a&gt;&lt;/p&gt;\n";
?&gt;
</code>
</pre>
              </div>
              <div class="codigo">
                <pre>
<code class="language-html">&lt;p&gt;Esta es la página 3.&lt;/p&gt;

&lt;p&gt;&lt;a href="bom-test-sin-bom-1.php"&gt;Volver a la página 1&lt;/a&gt;&lt;/p&gt;</code>
</pre>
              </div>
            </div>
            <div class="resultado-object">
              <object type="text/html" data="https://www.mclibre.org/consultar/especiales/php/bom-test/bom-test-sin-bom-1.php" style="height: 11em">ERROR (no puede mostrarse el objeto)</object>
            </div>
            <div class="icono-enlace">
              <a href="https://www.mclibre.org/consultar/especiales/php/bom-test/bom-test-sin-bom-1.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
            </div>
          </div>
        </li>
      </ul>
    </section>

    <hr class="corta">

    <p>Podemos eliminar la marca de orden de bytes de un archivo UTF-8 con Visual Studio Code, como se explica en la lección <a href="https://www.mclibre.org/consultar/informatica/lecciones/vsc-uso.html#modificar-juego-caracteres">Uso de Visual Studio Code</a> (de los apuntes de Informática general).</p>

    <p>Para eliminar las marcas de orden de bytes de un conjunto grande de archivos php, se puede utilizar este script de Linux:</p>

    <div class="codigo">
      <pre>
<code class="language-html">#! /bin/bash

find ./ -name "*.php" -type f | while read file
do
  if [[ -f $file &amp;&amp; `head -c 3 $file` == $'\xef\xbb\xbf' ]]; then
      # si el fichero existe y tiene BOM UTF-8
      mv $file $file.bak
      tail -c +4 $file.bak &gt; $file
      echo "BOM eliminado en $file"
  fi
done</code>
</pre>
    </div>
  </section>

  <section id="redirecciones">
    <h2>Redirecciones: header("Location:...")</h2>

    <p>La función <a href="https://www.php.net/manual/en/function.header.php"><span class="php-fun">header()</span></a> se puede utilizar para redirigir automáticamente a otra página, enviando como argumento la cadena <strong>Location:</strong> seguida de la dirección absoluta o relativa de la página a la que queremos redirigir.</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
header("Location:http://www.example.com/");
?&gt;</code>
</pre>
    </div>

    <p>Si además de redirigir a una página, se quieren enviar controles a dicha página, se pueden añadir a la cadena separando los controles con el carácter &amp;.</p>

    <p><strong>Nota</strong>: En este caso no se debe utilizar la entidad de carácter <strong>&amp;amp;</strong></p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
header("Location:http://www.example.com?nombre=Pepito&amp;edad=25");
?&gt;</code>
</pre>
    </div>

    <p>Si el valor a enviar contiene espacios, se pueden escribir caracteres <strong>+</strong> o espacios para separar las palabras:</p>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
header("Location:http://www.example.com?nombre=Pepito+Conejo&amp;edad=25");
?&gt;</code>
</pre>
    </div>

    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
header("Location:http://www.example.com?nombre=Pepito Conejo&amp;edad=25");
?&gt;</code>
</pre>
    </div>

    <p>El nombre de la cabecera (location) se puede escribir en mayúsculas o minúsculas y entre los dos puntos y la dirección puede haber espacios en blanco.</p>
    <div class="codigo">
      <pre>
<code class="language-php">&lt;?php
header("LoCaTiOn: http://www.example.com/");
?&gt;</code>
</pre>
    </div>

    <section id="resto">
      <h3>Resto del programa tras la redirección</h3>

      <p>La ejecución de un programa no se detiene al encontrar una redirección, sino que PHP ejecuta el programa hasta el final. Dependiendo de las instrucciones que haya tras la dirección, el resultado puede ser relevante o no.</p>
      <ul>
        <li>Si se escriben varias redirecciones, se aplicará la última. En el ejemplo siguiente, la página redirigiría a https://www.mclibre.org

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
header("Location:http://www.example.com/");
header("Location:https://www.mclibre.org/");
// Esta página redirige a www.mclibre.org
?&gt;</code>
</pre>
          </div>
        </li>
        <li>Si después de la redirección se genera texto, ese texto no llegará al usuario, puesto que la redirección le llevará antes a otra página.

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
header("Location:https://www.mclibre.org/");
print "&lt;p&gt;Nadie leerá este texto&lt;/p&gt;\n";
?&gt;</code>
</pre>
          </div>
        </li>
        <li>Si el programa realiza acciones como modificar registros en una base de datos, borrar archivos, etc., esas acciones sí que se realizarán. Por ejemplo, el siguiente programa redirige a la página web de mclibre, pero también se borra a sí mismo.

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
header("Location:https://www.mclibre.org/");
unlink("ejemplo.php");
?&gt;</code>
</pre>
          </div>
        </li>
      </ul>

      <hr class="corta">

      <p>Si tras una redirección no queremos que se ejecute el resto del programa, tenemos dos opciones:</p>

      <ul>
        <li>podemos utilizar una expresión <span class="php-res">if ... else ...</span>

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
if (condicion) {
    header("Location:https://www.mclibre.org/");
} else {
    ...
}
?&gt;</code>
</pre>
          </div>
        </li>
        <li>podemos utilizar la instrucción <a href="https://www.php.net/manual/en/function.exit.php"><span class="php-res">exit</span></a>, que detiene el programa en ese punto.

          <p>El ejemplo anterior se podría escribir entonces de la siguiente manera, sin necesidad de incluir las instrucciones posteriores en un bloque <span class="php-res">else ...</span>:</p>

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
if (condicion) {
    header("Location:https://www.mclibre.org/");
    exit;
}
// ...
?&gt;</code>
</pre>
          </div>
        </li>
      </ul>

      <hr class="corta">

      <p><span class="php-res">exit</span> no es una función, sino una palabra reservada del lenguaje, pero también se puede utilizar seguida de paréntesis como si fuera una función: <span class="php-res">exit()</span>:</p>

      <ul>
        <li>Si el argumento de <span class="php-res">exit()</span> es un valor numérico, el programa se interrumpiría y devolvería ese valor. Se suele utilizar para la gestión de errores en programas PHP pensados para ser llamados en la línea de comandos.</li>
        <li>Si el argumento de <span class="php-res">exit()</span> es una cadena, el programa escribiría ese valor y se interrumpiría.</li>
      </ul>

      <hr class="corta">

      <p>Hay que tener en cuenta que <span class="php-res">exit</span> detiene no sólo la ejecución del programa, sino también la de los programas que hubieran llamado a esos programas, como se muestra en los ejemplos siguientes:</p>

      <ul>
        <li>El programa ejemplo-1.php llama al programa ejemplo-2.php y el resultado incluye las instrucciones generadas por ambos programas. Es decir, si se ejecuta el programa ejemplo-1.php, el resultado final será una redirección a la página web de mclibre.

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
// ejemplo-1.php
include "ejemplo-2.php";
header("Location:https://www.mclibre.org/");
?&gt;</code>
</pre>
          </div>

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
// ejemplo-2.php
header("Location:http://www.example.com/");
?&gt;</code>
</pre>
          </div>
        </li>
        <li>Pero si en el segundo programa se añade <span class="php-res">exit</span>, se interrumpiría tanto el segundo como el primero. Es decir, si se ejecuta el programa ejemplo-3.php, el resultado final será una redirección a la página http://www.example.com/.

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
// ejemplo-3.php
include "ejemplo-4.php";
header("Location:https://www.mclibre.org/");
?&gt;</code>
</pre>
          </div>

          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
// ejemplo-4.php
header("Location:http://www.example.com/");
exit;
?&gt;</code>
</pre>
          </div>
        </li>
      </ul>
    </section>
  </section>

  <section id="otros-tipos">
    <h2>Crear con PHP otros tipos de archivos</h2>

    <p>Con instrucciones <span class="php-res">print</span>, PHP puede generar archivos con cualquier contenido (archivos de texto o incluso binarios), pero para que el navegador acepte esos archivos y los interprete correctamente, en las cabeceras se debe incluir el tipo MIME correspondiente. Existen muchos tipos MIME (véase lista de <a href="https://developer.mozilla.org/es/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Lista_completa_de_tipos_MIME">tipos MIME en MDN</a>), por ejemplo:</p>

    <table class="tabla-con-borde">
      <tr>
        <th>extensión del archivo</th>
        <th>tipo de archivo</th>
        <th>tipo MIME</th>
      </tr>
      <tr>
        <td>.html</td>
        <td>página web HTML</td>
        <td>text/html</td>
      </tr>
      <tr>
        <td>.css</td>
        <td>hoja de estilo CSS</td>
        <td>text/css</td>
      </tr>
      <tr>
        <td>.js</td>
        <td>JavaScript</td>
        <td>application/js</td>
      </tr>
      <tr>
        <td>.svg</td>
        <td>SVG</td>
        <td>image/svg+xml</td>
      </tr>
      <tr>
        <td>.json</td>
        <td>JSON</td>
        <td>application/json</td>
      </tr>
    </table>

    <p>El tipo MIME se indica en la cabecera, por lo que un programa PHP puede declarar el tipo MIME mediante la función <a href="https://www.php.net/manual/en/function.header.php"><span class="php-fun">header()</span></a>, enviando como argumento la cadena <strong>Content-type:</strong> seguida del tipo MIME correspondiente.</p>

    <section id="mime-css">
      <h3>Crear hojas de estilo CSS</h3>

      <p>El programa siguiente genera el texto correspondiente a una hoja de estilo CSS, concretamente dando color al fondo y al texto de forma aleatoria.</p>

      <div class="filaflex">
        <div class="codigo">
          <pre>
<code class="language-php">&lt;?php
$color = rand(0, 360);
print "body {\n";
print "  background-color: hsl($color, 50%, 90%);\n";
print "  color: hsl($color, 50%, 30%);\n";
print "}\n";
?&gt;</code>
</pre>
        </div>
        <div class="resultado-object">
          <object type="text/html" data="ejemplos/cabeceras/mime-css-sin-mime.php" style="height: 8em">ERROR (no puede mostrarse el objeto)</object>
        </div>
        <div class="icono-enlace">
          <a href="ejemplos/cabeceras/mime-css-sin-mime.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
        </div>
      </div>

      <p>Pero si llamamos a este programa en la etiqueta <span class="html-eti">&lt;link&gt;</span> de una página HTML, podemos comprobar que el navegador no aplica la hoja de estilo, como en el ejemplo siguiente. El problema se debe a que el servidor asigna por defecto el tipo MIME text/html a los ficheros generados por un programa PHP, pero los navegadores exigen que las hojas de estilo lleguen con el tipo MIME <strong>text/css</strong>. Aunque el contenido corresponda a una hoja de estilo, al no recibir el tipo MIME esperado, el navegador no interpreta su contenido.</p>

      <div class="filaflex">
        <div class="columnaflex">
          <div class="codigo">
            <pre><code class="language-html">&lt;link rel="stylesheet" href="<span class="codigo-resaltado">mime-css-sin-mime.php</span>" title="Color"&gt;</code></pre>
          </div>
          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
$color = rand(0, 360);
print "body {\n";
print "  background-color: hsl($color, 50%, 90%);\n";
print "  color: hsl($color, 50%, 30%);\n";
print "}\n";
?&gt;</code>
</pre>
          </div>
        </div>
        <div class="icono-ok">
          <img src="../varios/iconos/icono-okno.svg" alt="Incorrecto" title="Incorrecto" width="40" height="40">
        </div>
        <div class="resultado-object">
          <object type="text/html" data="ejemplos/cabeceras/mime-css-sin-mime.html" style="height: 8em">ERROR (no puede mostrarse el objeto)</object>
        </div>
        <div class="icono-enlace">
          <a href="ejemplos/cabeceras/mime-css-sin-mime.html"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
        </div>
      </div>

      <p>Para que el navegador aplique la hoja de estilo, el programa debe generar una cabecera que declare el tipo MIME de imagen <strong>text/css</strong>, como muestra el siguiente ejemplo.</p>

      <div class="filaflex">
        <div class="columnaflex">
          <div class="codigo">
            <pre><code class="language-html">&lt;link rel="stylesheet" href="<span class="codigo-resaltado">mime-css-con-mime.php</span>" title="Color"&gt;</code></pre>
          </div>
          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
<span class="codigo-resaltado">header("Content-type: text/css");</span>
$color = rand(0, 360);
print "body {\n";
print "  background-color: hsl($color, 50%, 90%);\n";
print "  color: hsl($color, 50%, 30%);\n";
print "}\n";
?&gt;</code>
</pre>
          </div>
        </div>
        <div class="icono-ok">
          <img src="../varios/iconos/icono-oksi.svg" alt="Correcto" title="Correcto" width="40" height="40">
        </div>
        <div class="resultado-object">
          <object type="text/html" data="ejemplos/cabeceras/mime-css-con-mime.html" style="height: 10em">ERROR (no puede mostrarse el objeto)</object>
        </div>
        <div class="icono-enlace">
          <a href="ejemplos/cabeceras/mime-css-con-mime.html"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
        </div>
      </div>
    </section>

    <section id="mime-svg">
      <h3>Crear imágenes SVG</h3>

      <p>El programa siguiente crea las etiquetas correspondientes a una imagen SVG, concretamente a un cuadrado de color aleatorio. Si escribimos directamente la url de ese programa en el navegador, el navegador muestra el contenido esperado.</p>

      <div class="filaflex">
        <div class="codigo">
          <pre>
<code class="language-php">&lt;?php
$color = rand(0, 360);

print "&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n";
print "&lt;svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" \n"
    . "    width=\"100\" height=\"100\" viewBox=\"-5 -5 100 100\"&gt;\n";
print "  &lt;rect fill=\"hsl($color, 100%, 70%)\" stroke=\"hsl($color, 100%, 30%)\" stroke-width=\"4\" "
    . "x=\"0\" y=\"0\" width=\"90\" height=\"90\" /&gt;\n";
print "&lt;/svg&gt;";
?&gt;</code>
</pre>
        </div>
        <div class="icono-ok">
          <img src="../varios/iconos/icono-okno.svg" alt="Incorrecto" title="Incorrecto" width="40" height="40">
        </div>
        <div class="resultado-object">
          <object type="text/html" data="ejemplos/cabeceras/mime-svg-sin-mime.php" style="height: 8em">ERROR (no puede mostrarse el objeto)</object>
        </div>
        <div class="icono-enlace">
          <a href="ejemplos/cabeceras/mime-svg-sin-mime.php"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
        </div>
      </div>

      <p>Pero aunque el navegador consiga mostrar el cuadrado, realmente no estamos haciendo bien las cosas. Una imagen SVG debería entregarse al navegador con el tipo MIME <strong>image/svg+xml</strong>. En este caso, el programa no declara ningún tipo MIME, así que el servidor lo entrega con el tipo MIME predeterminado de los programas PHP, el tipo MIME <strong>text/html</strong> (es decir, como página web). Aunque estrictamente hablando el documento no es una página web válida porque le faltan las etiquetas básicas como <span class="html-eti">&lt;html&gt;</span>, <span class="html-eti">&lt;head&gt;</span>, <span class="html-eti">&lt;body&gt;</span>, etc. los navegadores aceptan las páginas inválidas e intentan interpretar el contenido de la mejor manera posible. Por ello en este caso, el navegador consigue mostrar la imagen.</p>

      <p>Pero en otras circunstancias, este mismo programa no daría el resultado esperado. Como muestra el siguiente ejemplo, si el programa anterior se llama en una etiqueta <span class="html-eti">&lt;img&gt;</span>, el navegador no puede mostrar la imagen. El problema es que en una etiqueta el navegador tiene que recibir obligatoriamente algún tipo MIME de imagen (jpg, png, svg, etc.). Como pasaba en el ejemplo anterior de la hoja de estilo, si el documento se sirve con un tipo MIME incorrecto, los navegadores no intentan siquiera mostrar el contenido.</p>

      <div class="filaflex">
        <div class="columnaflex">
          <div class="codigo">
            <pre><code class="language-html">&lt;p&gt;&lt;img src="svg-sin-mime.php" alt="ERROR No puedo mostrar la imagen"&gt;&lt;/p&gt;</code></pre>
          </div>
          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
$color = rand(0, 360);

print "&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n";
print "&lt;svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" \n"
    . "    width=\"100\" height=\"100\" viewBox=\"-5 -5 100 100\"&gt;\n";
print "  &lt;rect fill=\"hsl($color, 100%, 70%)\" stroke=\"hsl($color, 100%, 30%)\" stroke-width=\"4\" "
    . "x=\"0\" y=\"0\" width=\"90\" height=\"90\" /&gt;\n";
print "&lt;/svg&gt;";
?&gt;</code>
</pre>
          </div>
        </div>
        <div class="icono-ok">
          <img src="../varios/iconos/icono-okno.svg" alt="Incorrecto" title="Incorrecto" width="40" height="40">
        </div>
        <div class="resultado-object">
          <object type="text/html" data="ejemplos/cabeceras/mime-svg-sin-mime.html" style="height: 8em">ERROR (no puede mostrarse el objeto)</object>
        </div>
        <div class="icono-enlace">
          <a href="ejemplos/cabeceras/mime-svg-sin-mime.html"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
        </div>
      </div>

      <p>Para que el navegador muestre correctamente la imagen, el programa debe generar una cabecera que declare el tipo MIME de imagen <strong>image/svg+xml</strong>, como muestra el siguiente ejemplo.</p>

      <div class="filaflex">
        <div class="columnaflex">
          <div class="codigo">
            <pre><code class="language-html">&lt;p&gt;&lt;img src="svg-con-mime.php" alt="ERROR No puedo mostrar la imagen"&gt;&lt;/p&gt;</code></pre>
          </div>
          <div class="codigo">
            <pre>
<code class="language-php">&lt;?php
header("Content-type: image/svg+xml");
$color = rand(0, 360);

print "&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n";
print "&lt;svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" \n"
    . "    width=\"100\" height=\"100\" viewBox=\"-5 -5 100 100\"&gt;\n";
print "  &lt;rect fill=\"hsl($color, 100%, 70%)\" stroke=\"hsl($color, 100%, 30%)\" stroke-width=\"4\" "
    . "x=\"0\" y=\"0\" width=\"90\" height=\"90\" /&gt;\n";
print "&lt;/svg&gt;";
?&gt;</code>
</pre>
          </div>
        </div>
        <div class="icono-ok">
          <img src="../varios/iconos/icono-oksi.svg" alt="Correcto" title="Correcto" width="40" height="40">
        </div>
        <div class="resultado-object">
          <object type="text/html" data="ejemplos/cabeceras/mime-svg-con-mime.html" style="height: 10em">ERROR (no puede mostrarse el objeto)</object>
        </div>
        <div class="icono-enlace">
          <a href="ejemplos/cabeceras/mime-svg-con-mime.html"><img src="../varios/iconos/icono-enlace.svg" alt="Enlace a ejemplo" title="Enlace a ejemplo" width="31" height="36"></a>
        </div>
      </div>

      <p><strong>Nota</strong>: Los archivos .svg deben comenzar por la declaración XML, que no es necesaria cuando la imagen SVG se incluye en la página web.</p>
      <div class="codigo">
        <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</code></pre>
      </div>
    </section>
  </section>

  <footer>
    <p class="ultmod">Última modificación de esta página: 12 de noviembre de 2021</p>

    <p class="licencia">
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES"><img src="../varios/iconos/icono-cc-by-sa.svg" alt="Licencia Creative Commons" title="Licencia Creative Commons BY-SA" width="120" height="42"></a><br>
      Esta página forma parte del curso <strong><a href="https://www.mclibre.org/consultar/php/">Programación web en PHP</a></strong> por <a href="https://www.mclibre.org/" rel="author">Bartolomé Sintes Marco</a><br>
      que se distribuye bajo una <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES">Licencia Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional (CC BY-SA 4.0)</a>.
    </p>
  </footer>
</body>
</html>
